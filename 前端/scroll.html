<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么时候出现滚动条 | 工作笔记</title>
    <meta name="description" content="Hendry的博客">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.eecf6a6a.css" as="style"><link rel="preload" href="/assets/js/app.f8bee57c.js" as="script"><link rel="preload" href="/assets/js/30.9832e5bd.js" as="script"><link rel="prefetch" href="/assets/js/10.837bbfd0.js"><link rel="prefetch" href="/assets/js/11.bbd08110.js"><link rel="prefetch" href="/assets/js/12.eb514b46.js"><link rel="prefetch" href="/assets/js/13.e2503408.js"><link rel="prefetch" href="/assets/js/14.d97c0ac2.js"><link rel="prefetch" href="/assets/js/15.baf7986f.js"><link rel="prefetch" href="/assets/js/16.2b12bf6f.js"><link rel="prefetch" href="/assets/js/17.f7e545ac.js"><link rel="prefetch" href="/assets/js/18.70d9230d.js"><link rel="prefetch" href="/assets/js/19.0a61e7ba.js"><link rel="prefetch" href="/assets/js/2.d139c70a.js"><link rel="prefetch" href="/assets/js/20.87141f48.js"><link rel="prefetch" href="/assets/js/21.536e6d3b.js"><link rel="prefetch" href="/assets/js/22.fa3e648a.js"><link rel="prefetch" href="/assets/js/23.f6c367b9.js"><link rel="prefetch" href="/assets/js/24.a8f770f5.js"><link rel="prefetch" href="/assets/js/25.3bb8bbfc.js"><link rel="prefetch" href="/assets/js/26.1c16cfb8.js"><link rel="prefetch" href="/assets/js/27.075df559.js"><link rel="prefetch" href="/assets/js/28.90c1e366.js"><link rel="prefetch" href="/assets/js/29.3145e78e.js"><link rel="prefetch" href="/assets/js/3.de89ea98.js"><link rel="prefetch" href="/assets/js/31.2f9a7c5b.js"><link rel="prefetch" href="/assets/js/32.df9181b5.js"><link rel="prefetch" href="/assets/js/33.ec53f96d.js"><link rel="prefetch" href="/assets/js/34.398a7128.js"><link rel="prefetch" href="/assets/js/35.bb1c5a48.js"><link rel="prefetch" href="/assets/js/36.935a5449.js"><link rel="prefetch" href="/assets/js/37.459fef35.js"><link rel="prefetch" href="/assets/js/38.f51023c1.js"><link rel="prefetch" href="/assets/js/39.ed9f7023.js"><link rel="prefetch" href="/assets/js/4.a889cc83.js"><link rel="prefetch" href="/assets/js/40.7959ecc5.js"><link rel="prefetch" href="/assets/js/41.2f350c5b.js"><link rel="prefetch" href="/assets/js/42.3a09f5a5.js"><link rel="prefetch" href="/assets/js/43.b22e3395.js"><link rel="prefetch" href="/assets/js/44.ea91f873.js"><link rel="prefetch" href="/assets/js/45.29363c9f.js"><link rel="prefetch" href="/assets/js/46.45848afe.js"><link rel="prefetch" href="/assets/js/47.309f8db5.js"><link rel="prefetch" href="/assets/js/48.4da217ee.js"><link rel="prefetch" href="/assets/js/49.713e67fd.js"><link rel="prefetch" href="/assets/js/5.7183a5fb.js"><link rel="prefetch" href="/assets/js/50.d90574c6.js"><link rel="prefetch" href="/assets/js/51.5190cc6c.js"><link rel="prefetch" href="/assets/js/52.25c37497.js"><link rel="prefetch" href="/assets/js/53.3fea90a3.js"><link rel="prefetch" href="/assets/js/54.d23ad054.js"><link rel="prefetch" href="/assets/js/55.d8ba3a31.js"><link rel="prefetch" href="/assets/js/56.bc578093.js"><link rel="prefetch" href="/assets/js/57.cb8c611e.js"><link rel="prefetch" href="/assets/js/58.4a6efece.js"><link rel="prefetch" href="/assets/js/59.397f12f2.js"><link rel="prefetch" href="/assets/js/6.6621a9ba.js"><link rel="prefetch" href="/assets/js/60.a209bb60.js"><link rel="prefetch" href="/assets/js/61.0a1b1f3b.js"><link rel="prefetch" href="/assets/js/62.a79409e9.js"><link rel="prefetch" href="/assets/js/63.f99fda12.js"><link rel="prefetch" href="/assets/js/64.59a96a9c.js"><link rel="prefetch" href="/assets/js/65.ab4be186.js"><link rel="prefetch" href="/assets/js/66.df4455cd.js"><link rel="prefetch" href="/assets/js/7.a024304b.js"><link rel="prefetch" href="/assets/js/8.be16c405.js"><link rel="prefetch" href="/assets/js/9.37e77487.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eecf6a6a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">工作笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>什么时候出现滚动条</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/%E5%89%8D%E7%AB%AF/scroll.html#底部被覆盖的问题解决" class="sidebar-link">底部被覆盖的问题解决</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/scroll.html#获取-offsettop-的时机" class="sidebar-link">获取 offsetTop 的时机</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/scroll.html#最后一页的高度不够" class="sidebar-link">最后一页的高度不够</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E5%89%8D%E7%AB%AF/scroll.html#注意" class="sidebar-link">注意</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p>例子: <code>Vue\vux_hendry</code></p> <h1 id="什么时候出现滚动条"><a href="#什么时候出现滚动条" aria-hidden="true" class="header-anchor">#</a> 什么时候出现滚动条</h1> <p>当子元素的高度超过父元素的高度 , 那么父元素会出现滚动条
需要定义样式 <code>overflow-y:auto;</code></p> <p>例子 :</p> <p>mui 里面 , 页面结构是<code>mheader</code> , <code>mbody</code> <code>mheader</code> 就是 mui-bar 样式类的<code>header</code> <code>mbody</code> 就是<code>mui-content</code> 样式类的<code>div</code></p> <p>而我们要的滚动区域是放在<code>mui-content</code>里面</p> <p>于是我们先把<code>mui-content</code> 设置为绝对定位为左上角 , 且 mui 是对<code>mui-content</code> 处理过的
<code>mui-content</code> 是会预留一定空白高度给<code>header</code>的, 于是即使定位 content 是左上角,
<code>header</code>是重叠放在<code>content</code>之上的, 但是不会遮住<code>content</code>内容的</p> <p>定位<code>mui-content</code>为<code>absolute</code> , 然后对需要<code>滚动条</code>的容器设置<code>overflow-y:auto;</code></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.mui-content</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.mui-content &gt; div</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="滚动条父元素容器的-3-个属性-clientheight-scrollheight-scrolltop"><a href="#滚动条父元素容器的-3-个属性-clientheight-scrollheight-scrolltop" aria-hidden="true" class="header-anchor">#</a> 滚动条父元素容器的 3 个属性 clientHeight , scrollHeight , scrollTop</h1> <p><code>http://www.cnblogs.com/cheerful-queen/p/6382933.html</code></p> <ol><li>可视高度<code>clientHeight</code> 由容器<code>height</code>决定, 一般容器<code>height</code>定义为所有可用高度.</li></ol> <p>这样该<code>div</code> 下的内容只要高度超过, 父容器定义了<code>height:100%</code></p> <p>实际上是定义的可视区域 , 这个<code>height</code> , 就确定了 <code>clientHeight</code></p> <p><code>clientHeight</code> = <code>CSS height</code> + <code>CSS padding</code> - <code>水平滚动条高度</code></p> <p>且它是只读的, 于是当我们指定了滚动条容器的<code>height=100%</code> 可用高度后, 那么这个<code>可视高度</code>区域就固定了</p> <ol start="2"><li><code>scrollHeight</code> 也是只读属性, 它由容器下的内容决定, 包括由于溢出内容在屏幕上不可见的高度</li></ol> <ol start="3"><li><p><code>scrollTop</code> , 当容器的内容高度<code>scrollHeight</code>, 大于容器的可视高度<code>clientHeight</code>时出现滚动条
而滚动条的位置由<code>scrollTop</code> 来确定, <code>1,2</code> 属性都是只读, 而<code>scrollTop</code>该属性是可写的</p> <p>特点：</p></li></ol> <ul><li>未设置时默认为 0</li> <li>为负值时不做任何响应</li> <li>设置为超出本身最大值时，默认为最大值</li></ul> <p><code>scrollTop</code> 是个<code>offset</code>的概念 , 它表示从哪个位置开始, 把<code>内容高度</code>放到可视区域进行显示</p> <p>所以顶部的时候</p> <p><code>scrollTop + clientHeight == clientHeight</code> 说明是顶部, scrollTop == 0</p> <p><code>scrollTop + clientHeight == scrollHeight</code> // 底部</p> <p>滑动到了底部, 内容高度的<code>offset</code> 被设置的很大, 这个<code>offset</code> + <code>屏幕高度</code>, 应该等于整个<code>内容高度</code></p> <p>滚动条的 top 是小数, 因此判断时需要向上取整</p> <p><code>Math.ceil(contentArea.scrollTop + contentArea.clientHeight) == contentArea.scrollHeight</code>
// 底部时, 返回 true</p> <p>还有一些其他的 css 高度属性, 都可以不去管, 否则多了不好理解</p> <p>需要记住的就是<code>scrollTop</code> , <code>clientHeight</code>, <code>scrollHeight</code> 即可</p> <p><code>clientHeight</code> 由控件的<code>height高度</code>确定<code>可视高度</code>, 只读
<code>scrollHeight</code> 由子元素内容确定<code>内容高度</code> <code>scrollTop</code> 内容高度的<code>top起始位置</code>放到可视区域进行显示, 可写</p> <h2 id="底部被覆盖的问题解决"><a href="#底部被覆盖的问题解决" aria-hidden="true" class="header-anchor">#</a> 底部被覆盖的问题解决</h2> <p>当容器内容底部, 比如被按钮栏覆盖遮住的时候, 怎么解决</p> <p>可能会想到把<code>scrollTop</code> 设置大一些, 但实际上行不通 <code>设置为超出本身最大值时，默认为最大值</code></p> <p>根据前面知识可知 <code>scrollTop</code> 最大只能设置为 <code>scrollHeight - clientHeight</code> , 设置超出也不起作用</p> <p>方法 1 :</p> <p>从内容入手 , 是在容器的内容区域底部增加空白内容高度 , 但那样的话滚动条似乎能看出来有一截</p> <p>方法 2:</p> <p>从可是区域入手, 根本问题其实是可视区域被挡住, 那么我们可以设置<code>可视高度</code> 不要被挡住即可
比如上面例子中设置可视高度为可用高度的 <code>80%</code> , 而不是<code>100%</code> <code>height: 80%;</code></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.mui-content &gt; div</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 80%<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="滚动条容器内子元素的属性-offsettop"><a href="#滚动条容器内子元素的属性-offsettop" aria-hidden="true" class="header-anchor">#</a> 滚动条容器内子元素的属性 offsetTop</h1> <p>父元素内部的所有元素的高度 , 也就是<code>内容高度</code>, 当我们需要让滚动条滚动的时候需要设置 scrollTop</p> <p>但 scrollTop 设置为多少呢? 于是就需要确定, 每个子元素相对于顶部的位置, 这个属性就是<code>offsetTop</code></p> <p>注意, 这个值是容器内子元素的属性 , 每个子元素都有一个 <code>offsetTop</code></p> <p>比较常用的做法是, 每个<code>子元素</code>都设置为相同的类, 这样方便选择器进行选择, 然后将他们的<code>offsetTop</code> 保存到数组里面</p> <p>这样就方便我们使用, 将 offsetTop 赋值给 scrollTop 进行滚动操作</p> <p>// 如: 左侧是菜单, 右侧是滚动区域 , 实现点击左侧菜单, 右侧则滚动到对应区域</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 获取子元素的offsetTop, 保存到数组 , 这个数组中的值, 赋值给scrollTop即可滚动到对应位置</span>

<span class="token punctuation">;</span><span class="token punctuation">(</span>contentItems <span class="token operator">=</span> contentArea<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.content-item'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 所有子元素dom对象</span>
  <span class="token punctuation">(</span>contentAreaTops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//定义一个数组来保存右边的每个contentItems的offsetTop值, 也就是父容器滚动条对应的scrollTop值。</span>
<span class="token keyword">function</span> <span class="token function">setAreaTops</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    len <span class="token operator">=</span> contentItems<span class="token punctuation">.</span>length
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    contentAreaTops<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> contentItems<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">setAreaTops</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//获取右边的每一个item的offsetTop值</span>

<span class="token comment">// 2. 添加菜单事件, 点击执行scrollTo</span>
<span class="token function">mui</span><span class="token punctuation">(</span><span class="token string">'#leftBar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'tap'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-index'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">//直接让右边的容器的scrollTop = contentAreaTops[i]</span>
  contentArea<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> contentAreaTops<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>上面代码就基本实现了, 点击左侧菜单, 右侧则滚动到相应位置, 其中左侧菜单的事件 , 用到委托的概念, 或者说代理模式</p> <p>就是说, 子元素的事件处理, 并不是直接绑定在子元素上, 而是绑定在父元素上, 比如这里需要处理的是点击的<code>a</code>标签, 但实际事件处理是绑定在<code>#leftBar</code>, 这个就是<code>事件委托</code></p> <p><code>https://www.cnblogs.com/owenChen/archive/2013/02/18/2915521.html</code> , 这个委托之所以可行, 是因为 dom 的冒泡机制, 使得在父元素上可以捕获到子元素的事件,</p> <p>且事件的<code>target</code> 依然是<code>a</code> , 所以事件处理上可以获取到<code>target</code>相关的属性 , 子元素的事件通过父元素来捕获, 常用来设置同一个父节点下类似的子元素的事件处理</p> <h2 id="获取-offsettop-的时机"><a href="#获取-offsettop-的时机" aria-hidden="true" class="header-anchor">#</a> 获取 offsetTop 的时机</h2> <p>在测试的时候就发现有个问题, 当点击左侧菜单的时候, 右侧的滚动位置不是每次都一样, 有的时候正常, 有的时候会差一点</p> <p>后来在控制台直接获取<code>contentAreaTops</code> 这个数组 , 发现值有变化, 按理来说右侧内容区域每个分组相对顶部的<code>offsetTop</code>是固定不变的</p> <p>但实际测试发现这个值却是有变化的, 原因就是因为页面的加载, 就是说, 如果页面内容加载没有完成, 和页面加载完成所获取的<code>offsetTop</code> 是不同的</p> <p>所以, <code>offsetTop</code>错误, 导致滚动条<code>scrollTop</code> 滚动到错误地方</p> <p>因此滚动条的滚动必须要放在回调里面, 放在内容加载完毕的回调里面猜呢过去获取 <code>子元素的offsetTop</code> , 否则就会有不一致的问题</p> <p>// 见上面代码<code>contentAreaTops</code> 放的就是<code>子元素的offsetTop</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">contentAreaTops</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">339</span><span class="token punctuation">,</span> <span class="token number">683</span><span class="token punctuation">,</span> <span class="token number">1027</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment">// 刷新</span>
<span class="token function">contentAreaTops</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">241</span><span class="token punctuation">,</span> <span class="token number">387</span><span class="token punctuation">,</span> <span class="token number">576</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment">// 再次刷新</span>
<span class="token function">contentAreaTops</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">339</span><span class="token punctuation">,</span> <span class="token number">777</span><span class="token punctuation">,</span> <span class="token number">1121</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p>解决方法</p> <ol><li>每次点击的时候都去初始化计算一次, 容器内部元素的<code>offsetTop</code></li></ol> <p>原始代码中, 初始化位置数组, 获取滚动内部元素的<code>offsetTop</code> 可能是在页面未渲染完成的时候, 所以每次的值都不一定正确</p> <p>而当用户点击的时候, 我们都去重新初始化<code>contentAreaTops</code> 问题基本解决</p> <p>因为用户不太可能在页面还没有渲染完成的时候就去点菜单, 即使点了菜单, 也会重新计算获取正确位置</p> <h2 id="最后一页的高度不够"><a href="#最后一页的高度不够" aria-hidden="true" class="header-anchor">#</a> 最后一页的高度不够</h2> <p>当最后一页的高度不够的时候, 顶部会显示一部分的倒数第二页的内容 , 即使把这个 scrollTop 设置更大 , 也不行</p> <p>只能把最后一页的高度调整为合适的高度</p> <ol><li>判断最后一页的高度是否不够</li></ol> <p><code>contentItems[3].clientHeight - contentArea.clientHeight</code> 用最后一页的内容的高度 减去 可视高度, 如果是负数说明我们需要对最后一页高度补全</p> <ol start="2"><li>直接设置最后一页的高度为可视高度</li></ol> <p><code>contentItems[3].style.height = contentArea.clientHeight</code></p> <h2 id="注意"><a href="#注意" aria-hidden="true" class="header-anchor">#</a> 注意</h2> <p>内容在滚动的时候, 需要知道具体是对应的哪个菜单项,</p> <p>判断的时候有两种方法</p> <ol><li>判断滚动条的位置是否位于, 内容高度范围之间</li> <li>就是 判断哪个区域的 offsetTop 和滚动条的位置,最接近</li></ol> <p>第一种方式会存在误差,比如页面已经在显示最后一个区块, 但是高度不够, 于是屏幕主体已经显示的是最后一个内容块, 但菜单项没有正确设置</p> <p>以前的解决方法是, 最后一个内容区块如果高度不够那么就手动去设置高度, 左右分屏这个样做是挺正常的</p> <p>但是有的时候, 这样做就影响了界面 是不能这么做的 , 所以我们可以把判断范围的顶部缩小一下即可</p> <p>另外如果是 scrollTop 来判断就不存在这个问题</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollBlocksHeights<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> height1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollBlocksHeights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// current section top</span>
        <span class="token keyword">let</span> height2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollBlocksHeights<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// current section bottom , next section top</span>
        <span class="token comment">// 这里判断是否是当前区块的时候, 并不需要让scroll的位置完全超过内容的offset ,</span>
        <span class="token comment">// 那样的话, 比如最后的一个内容区域已经在屏幕中显示, 但是因为scroll位置没有超过内容的offset ,</span>
        <span class="token comment">// 于是会导致index 没有正确切换赋值</span>
        <span class="token comment">// 所以这里改成 scroll顶部和内容的顶部 还差顶部300 个像素就认为, 已经是在显示了下个区块</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>scrollInfo<span class="token punctuation">.</span>position <span class="token operator">&gt;=</span> height1 <span class="token operator">-</span> <span class="token number">300</span>  <span class="token operator">&amp;&amp;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>scrollInfo<span class="token punctuation">.</span>position <span class="token operator">&lt;</span> height2
        <span class="token punctuation">)</span>

</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f8bee57c.js" defer></script><script src="/assets/js/30.9832e5bd.js" defer></script>
  </body>
</html>
