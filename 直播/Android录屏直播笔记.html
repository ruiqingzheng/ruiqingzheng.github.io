<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>录屏 | 工作笔记</title>
    <meta name="description" content="Hendry的博客">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.eecf6a6a.css" as="style"><link rel="preload" href="/assets/js/app.f8bee57c.js" as="script"><link rel="preload" href="/assets/js/44.ea91f873.js" as="script"><link rel="prefetch" href="/assets/js/10.837bbfd0.js"><link rel="prefetch" href="/assets/js/11.bbd08110.js"><link rel="prefetch" href="/assets/js/12.eb514b46.js"><link rel="prefetch" href="/assets/js/13.e2503408.js"><link rel="prefetch" href="/assets/js/14.d97c0ac2.js"><link rel="prefetch" href="/assets/js/15.baf7986f.js"><link rel="prefetch" href="/assets/js/16.2b12bf6f.js"><link rel="prefetch" href="/assets/js/17.f7e545ac.js"><link rel="prefetch" href="/assets/js/18.70d9230d.js"><link rel="prefetch" href="/assets/js/19.0a61e7ba.js"><link rel="prefetch" href="/assets/js/2.d139c70a.js"><link rel="prefetch" href="/assets/js/20.87141f48.js"><link rel="prefetch" href="/assets/js/21.536e6d3b.js"><link rel="prefetch" href="/assets/js/22.fa3e648a.js"><link rel="prefetch" href="/assets/js/23.f6c367b9.js"><link rel="prefetch" href="/assets/js/24.a8f770f5.js"><link rel="prefetch" href="/assets/js/25.3bb8bbfc.js"><link rel="prefetch" href="/assets/js/26.1c16cfb8.js"><link rel="prefetch" href="/assets/js/27.075df559.js"><link rel="prefetch" href="/assets/js/28.90c1e366.js"><link rel="prefetch" href="/assets/js/29.3145e78e.js"><link rel="prefetch" href="/assets/js/3.de89ea98.js"><link rel="prefetch" href="/assets/js/30.9832e5bd.js"><link rel="prefetch" href="/assets/js/31.2f9a7c5b.js"><link rel="prefetch" href="/assets/js/32.df9181b5.js"><link rel="prefetch" href="/assets/js/33.ec53f96d.js"><link rel="prefetch" href="/assets/js/34.398a7128.js"><link rel="prefetch" href="/assets/js/35.bb1c5a48.js"><link rel="prefetch" href="/assets/js/36.935a5449.js"><link rel="prefetch" href="/assets/js/37.459fef35.js"><link rel="prefetch" href="/assets/js/38.f51023c1.js"><link rel="prefetch" href="/assets/js/39.ed9f7023.js"><link rel="prefetch" href="/assets/js/4.a889cc83.js"><link rel="prefetch" href="/assets/js/40.7959ecc5.js"><link rel="prefetch" href="/assets/js/41.2f350c5b.js"><link rel="prefetch" href="/assets/js/42.3a09f5a5.js"><link rel="prefetch" href="/assets/js/43.b22e3395.js"><link rel="prefetch" href="/assets/js/45.29363c9f.js"><link rel="prefetch" href="/assets/js/46.45848afe.js"><link rel="prefetch" href="/assets/js/47.309f8db5.js"><link rel="prefetch" href="/assets/js/48.4da217ee.js"><link rel="prefetch" href="/assets/js/49.713e67fd.js"><link rel="prefetch" href="/assets/js/5.7183a5fb.js"><link rel="prefetch" href="/assets/js/50.d90574c6.js"><link rel="prefetch" href="/assets/js/51.5190cc6c.js"><link rel="prefetch" href="/assets/js/52.25c37497.js"><link rel="prefetch" href="/assets/js/53.3fea90a3.js"><link rel="prefetch" href="/assets/js/54.d23ad054.js"><link rel="prefetch" href="/assets/js/55.d8ba3a31.js"><link rel="prefetch" href="/assets/js/56.bc578093.js"><link rel="prefetch" href="/assets/js/57.cb8c611e.js"><link rel="prefetch" href="/assets/js/58.4a6efece.js"><link rel="prefetch" href="/assets/js/59.397f12f2.js"><link rel="prefetch" href="/assets/js/6.6621a9ba.js"><link rel="prefetch" href="/assets/js/60.a209bb60.js"><link rel="prefetch" href="/assets/js/61.0a1b1f3b.js"><link rel="prefetch" href="/assets/js/62.a79409e9.js"><link rel="prefetch" href="/assets/js/63.f99fda12.js"><link rel="prefetch" href="/assets/js/64.59a96a9c.js"><link rel="prefetch" href="/assets/js/65.ab4be186.js"><link rel="prefetch" href="/assets/js/66.df4455cd.js"><link rel="prefetch" href="/assets/js/7.a024304b.js"><link rel="prefetch" href="/assets/js/8.be16c405.js"><link rel="prefetch" href="/assets/js/9.37e77487.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eecf6a6a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">工作笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>录屏</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/%E7%9B%B4%E6%92%AD/Android%E5%BD%95%E5%B1%8F%E7%9B%B4%E6%92%AD%E7%AC%94%E8%AE%B0.html#demo-步骤流程" class="sidebar-link">demo 步骤流程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E7%9B%B4%E6%92%AD/Android%E5%BD%95%E5%B1%8F%E7%9B%B4%E6%92%AD%E7%AC%94%E8%AE%B0.html#debug" class="sidebar-link">DEBUG</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E7%9B%B4%E6%92%AD/Android%E5%BD%95%E5%B1%8F%E7%9B%B4%E6%92%AD%E7%AC%94%E8%AE%B0.html#debug-surfacemediasource-could-not-be-initialized" class="sidebar-link">debug SurfaceMediaSource could not be initialized</a></li><li class="sidebar-sub-header"><a href="/%E7%9B%B4%E6%92%AD/Android%E5%BD%95%E5%B1%8F%E7%9B%B4%E6%92%AD%E7%AC%94%E8%AE%B0.html#导入-github-上的推流项目时候遇到的一些问题" class="sidebar-link">导入 github 上的推流项目时候遇到的一些问题</a></li><li class="sidebar-sub-header"><a href="/%E7%9B%B4%E6%92%AD/Android%E5%BD%95%E5%B1%8F%E7%9B%B4%E6%92%AD%E7%AC%94%E8%AE%B0.html#找不到-aapt-错误" class="sidebar-link">找不到 aapt 错误</a></li><li class="sidebar-sub-header"><a href="/%E7%9B%B4%E6%92%AD/Android%E5%BD%95%E5%B1%8F%E7%9B%B4%E6%92%AD%E7%AC%94%E8%AE%B0.html#ndk-不编译-mips-平台" class="sidebar-link">NDK 不编译 mips 平台</a></li><li class="sidebar-sub-header"><a href="/%E7%9B%B4%E6%92%AD/Android%E5%BD%95%E5%B1%8F%E7%9B%B4%E6%92%AD%E7%AC%94%E8%AE%B0.html#buildconfig-使用-gradle-配置文件来定义常量" class="sidebar-link">BuildConfig 使用 gradle 配置文件来定义常量</a></li><li class="sidebar-sub-header"><a href="/%E7%9B%B4%E6%92%AD/Android%E5%BD%95%E5%B1%8F%E7%9B%B4%E6%92%AD%E7%AC%94%E8%AE%B0.html#sdk-mips-问题" class="sidebar-link">sdk mips 问题</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="录屏"><a href="#录屏" aria-hidden="true" class="header-anchor">#</a> 录屏</h1> <p>录屏功能是 android sdk 提供接口实现的</p> <p>主要用的是 MediaRecorder 这个类, 它很方便的可以用来录屏保存为文件,</p> <p>而我们推流的话, 是需要得到 H264 裸流, 而 MediaRecorder 使用中并没有直接接触到裸流</p> <p>在更早版本 andriod 中, 如果不用 MediaRecorder 的话, 录屏保存文件用的是 MediaMuxer 这个类, 其他步骤是一致的</p> <p>录屏的过程中核心类是 <code>MediaProjection</code> , 其中的 <code>createVirtualDisplay</code> 方法 (<code>Creates a VirtualDisplay to capture the contents of the screen.</code>),</p> <p>而这个方法中的, 需要传递 <code>surface</code> 参数, <code>surface</code> 是<code>数据消费者</code> , 也就是说录屏的数据输出传递给该 <code>surface</code></p> <p><code>The surface to which the content of the virtual display should be rendered</code></p> <p>所以 <code>createVirtualDisplay</code> 传参 <code>mediaRecorder.getSurface()</code> 即可把录屏流数据传递给 <code>mediaRecorder</code> 对象中的 surf`ace</p> <h2 id="demo-步骤流程"><a href="#demo-步骤流程" aria-hidden="true" class="header-anchor">#</a> demo 步骤流程</h2> <p>(参考 <code>youtube</code> 视频 )</p> <ul><li><p>新建项目， <code>emptyActivity</code>
使用 <code>materialDesign</code> 风格控件, 修改 <code>gradle</code> <code>implementation 'com.android.support:design:28.0.0'</code></p></li> <li><p>声明权限 <code>declare permissions</code></p></li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>android.permission.RECORD_AUDIO<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>初始化布局 (design layout)</li></ul> <p><code>layout</code> 文件中使用 <code>VideoView</code> 控件和 <code>toggleButton</code></p> <ul><li><code>activity</code></li></ul> <p>在 <code>activity</code> 中初始化变量， 申请权限等</p> <p>主要用到的类有下面几个类， 需要仔细看文档</p> <p><code>android.media.MediaRecorder</code></p> <blockquote><blockquote><p><code>/reference/android/media/MediaRecorder.html</code></p></blockquote></blockquote> <div class="language-s extra-class"><pre class="language-text"><code>
Used to record audio and video. The recording control is based on a simple state machine (see below).

Surface getSurface ()

Gets the surface to record from when using SURFACE video source.

            mediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE);

private VirtualDisplay createVirtualDisplay() {
return mediaProjection.createVirtualDisplay(&quot;MainActivity&quot;, DISPLAY_WIDTH, DISPLAY_HEIGHT, mScreenDensity,
DisplayManager.VIRTUAL_DISPLAY_FLAG_AUTO_MIRROR,
mediaRecorder.getSurface(), null, null);
}
</code></pre></div><blockquote><blockquote><p><code>/reference/android/app/Activity.html</code></p></blockquote></blockquote> <div class="language-s extra-class"><pre class="language-text"><code>
Sometimes you want to get a result back from an activity when it ends.
For example, you may start an activity that lets the user pick a person in a list of contacts;
when it ends, it returns the person that was selected.
To do this, you call the startActivityForResult(Intent, int) version with a second integer parameter identifying the call.
The result will come back through your onActivityResult(int, int, Intent) method.
</code></pre></div><blockquote><blockquote><p>activity</p></blockquote></blockquote> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

     <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> PICK_CONTACT_REQUEST <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

     <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onKeyDown</span><span class="token punctuation">(</span><span class="token keyword">int</span> keyCode<span class="token punctuation">,</span> <span class="token class-name">KeyEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_DPAD_CENTER<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">// When the user center presses, let them pick a contact.</span>
             <span class="token function">startActivityForResult</span><span class="token punctuation">(</span>
                 <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span>ACTION_PICK<span class="token punctuation">,</span>
                 <span class="token keyword">new</span> <span class="token class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;content://contacts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                 PICK_CONTACT_REQUEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onActivityResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token keyword">int</span> resultCode<span class="token punctuation">,</span>
             <span class="token class-name">Intent</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> PICK_CONTACT_REQUEST<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>resultCode <span class="token operator">==</span> RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 <span class="token comment">// A contact was picked.  Here we will just display it</span>
                 <span class="token comment">// to the user.</span>
                 <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span>ACTION_VIEW<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> <span class="token punctuation">}</span>

</code></pre></div><p><strong>其他直接看代码和文档</strong></p> <h2 id="debug"><a href="#debug" aria-hidden="true" class="header-anchor">#</a> DEBUG</h2> <h3 id="debug-surfacemediasource-could-not-be-initialized"><a href="#debug-surfacemediasource-could-not-be-initialized" aria-hidden="true" class="header-anchor">#</a> debug <code>SurfaceMediaSource could not be initialized</code></h3> <div class="language-s extra-class"><pre class="language-text"><code>04-13 22:07:11.579 30772-30772/com.hendry.androidrecordscreen
E/MediaRecorder: SurfaceMediaSource could not be initialized!
</code></pre></div><p>提示错误无法初始化 <code>SurfaceMediaSource</code>, 结果是因为没有设置 <code>setOutputFile</code>，</p> <p>加上这句就好了 <code>mediaRecorder.setOutputFile(videoUri);</code></p> <div class="language-s extra-class"><pre class="language-text"><code>04-13 23:13:05.518 8346-8346/com.hendry.androidrecordscreen E/System: stat file error, path is /data/app/com.hendry.androidrecordscreen-1/lib/arm64, exception is android.system.ErrnoException: stat failed: ENOENT (No such file or directory)
</code></pre></div><h3 id="导入-github-上的推流项目时候遇到的一些问题"><a href="#导入-github-上的推流项目时候遇到的一些问题" aria-hidden="true" class="header-anchor">#</a> 导入 github 上的推流项目时候遇到的一些问题</h3> <h4 id="gradle-版本问题"><a href="#gradle-版本问题" aria-hidden="true" class="header-anchor">#</a> gradle 版本问题</h4> <div class="language-java extra-class"><pre class="language-java"><code>ERROR<span class="token operator">:</span> <span class="token class-name">The</span> versions of the <span class="token class-name">Android</span> <span class="token class-name">Gradle</span> plugin and <span class="token class-name">Gradle</span> are not compatible<span class="token punctuation">.</span>
<span class="token class-name">Please</span> <span class="token keyword">do</span> one of the following<span class="token operator">:</span>
<span class="token class-name">Update</span> your plugin <span class="token keyword">to</span> version <span class="token number">2.4</span><span class="token punctuation">.</span> <span class="token class-name">This</span> will require changes <span class="token keyword">to</span> <span class="token namespace">build<span class="token punctuation">.</span>gradle</span> due <span class="token keyword">to</span> API changes<span class="token punctuation">.</span>

</code></pre></div><p>原因是因为项目的 gradle 配置文件中 classpath 指定了低版本的 gradle, 因此需要把 gradle-wrapper 的版本也降低</p> <p>一般情况下, 可能一些代码比较久, 于是它的 build.gradle 中配置的 gradle 比较低版本</p> <p>而项目在导入到 as 的时候, 默认会用比较高的 gradle, 一般都是可以兼容的, 但是在少数情况下会提示错误,</p> <p>于是需要降低 gradle 版本修改 gradle-wrapper.properties 文件</p> <p>// project build.gradle</p> <p><code>classpath 'com.android.tools.build:gradle:3.3.2'</code></p> <p>// gradle-wrapper.properties</p> <p><code>distributionUrl=https\://services.gradle.org/distributions/gradle-4.10.1-all.zip</code></p> <p>或者自己手动下载 gradle-wrapper 对应版本的文件</p> <p>https://www.jianshu.com/p/9acedba802bb</p> <p>https://stackoverflow.com/questions/42007826/downgrade-gradle-from-3-3-to-2-14-1</p> <p>If you're using the gradle wrapper, then there'll be a folder in your project named &quot;gradle&quot; with a subfolder named &quot;wrapper&quot;, inside that, there are 2 files:</p> <ul><li>gradle-wrapper.jar</li> <li>gradle-wrapper.properties</li></ul> <p>Open &quot;gradle-wrapper.properties&quot; and change the place where it says &quot;3.3&quot; to &quot;2.14.1&quot;. Then sync gradle, and it will automatically download 2.14.1.</p> <p>If you're using the new 2.3 Android Studio, you HAVE to use gradle wrapper 3.3, as its the minimum supported gradle wrapper version. If so, then you'll have to download Android Studio 2.2, or fix whatever issue you have in your project that needs gradle wrapper version 2.14.1.</p> <p>To get more information about whatever the issue is, try running this: ./gradlew clean assemble -stacktrace</p> <p>That will clean your project, try and compile it, and if/when it fails, it will show you a stacktrace of the error.</p> <p>http://services.gradle.org/distributions/</p> <h3 id="找不到-aapt-错误"><a href="#找不到-aapt-错误" aria-hidden="true" class="header-anchor">#</a> 找不到 aapt 错误</h3> <p>Could not find com.android.tools.build:aapt2:3.3.2-5309881.</p> <p>https://stackoverflow.com/questions/55064741/could-not-find-com-android-tools-buildaapt23-3-2-5309881</p> <p>add the google() in build.gradle</p> <div class="language-js extra-class"><pre class="language-js"><code>allprojects <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
     <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">--</span><span class="token operator">&gt;</span>add <span class="token keyword">this</span> line
     <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="ndk-不编译-mips-平台"><a href="#ndk-不编译-mips-平台" aria-hidden="true" class="header-anchor">#</a> NDK 不编译 mips 平台</h3> <p>错误提示</p> <div class="language-s extra-class"><pre class="language-text"><code>
org.gradle.api.tasks.TaskExecutionException: Execution failed for task ':app:transformNativeLibsWithStripDebugSymbolForDebug'.
</code></pre></div><p><code>https://stackoverflow.com/questions/42739916/aarch64-linux-android-strip-file-missing</code></p> <div class="language-s extra-class"><pre class="language-text"><code>
Caused by: org.gradle.process.internal.ExecException: A problem occurred starting process 'command '/Users/hendry/Library/Android/sdk/ndk-bundle/toolchains/mips64el-linux-android/prebuilt/darwin-x86_64/bin/mips64el-linux-android-strip''
at org.gradle.process.internal.DefaultExecHandle.execExceptionFor(DefaultExecHandle.java:220)
at org.gradle.process.internal.DefaultExecHandle.setEndStateInfo(DefaultExecHandle.java:204)
at org.gradle.process.internal.DefaultExecHandle.failed(DefaultExecHandle.java:340)
at org.gradle.process.internal.ExecHandleRunner.run(ExecHandleRunner.java:86)
at org.gradle.internal.operations.BuildOperationIdentifierPreservingRunnable.run(BuildOperationIdentifierPreservingRunnable.java:39)
</code></pre></div><p>// 在 <code>app module</code> 的 <code>build.gradle</code> 文件中的 android 配置块中添加配置</p> <div class="language-js extra-class"><pre class="language-js"><code>packagingOptions<span class="token punctuation">{</span>
    doNotStrip <span class="token string">'*/mips/*.so'</span>
    doNotStrip <span class="token string">'*/mips64/*.so'</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="buildconfig-使用-gradle-配置文件来定义常量"><a href="#buildconfig-使用-gradle-配置文件来定义常量" aria-hidden="true" class="header-anchor">#</a> BuildConfig 使用 gradle 配置文件来定义常量</h3> <p>一般 project 的 build.gradle 文件中定义的是项目依赖, 常量不会被定义在这里</p> <p>而我们的应用代码一般是 app 文件夹, 可能还有相关的项目文件夹, 他们都是 module,</p> <p>那么定义一些常量, 可以用 gradle 配置文件来定义, 比如 app 相关的常量就定义在 app module 的 build.gradle 文件中</p> <p>这里以某个项目的 STREAMING_URL 常量为例</p> <p><code>https://www.jianshu.com/p/3d9b23afe514</code></p> <p>// app module build.gradle</p> <div class="language-js extra-class"><pre class="language-js"><code>android <span class="token punctuation">{</span>
    compileSdkVersion <span class="token constant">COMPILE_SDK_VERSION</span> <span class="token keyword">as</span> int
    buildToolsVersion <span class="token constant">BUILD_TOOLS_VERSION</span>
    defaultConfig <span class="token punctuation">{</span>
        applicationId <span class="token string">&quot;com.takusemba.rtmppublishersample&quot;</span>

        minSdkVersion <span class="token constant">MIN_SDK_VERSION</span> <span class="token keyword">as</span> int
        targetSdkVersion <span class="token constant">TARGET_SDK_VERSION</span> <span class="token keyword">as</span> int
        versionCode <span class="token constant">LIBRARY_VERSION_CODE</span> <span class="token keyword">as</span> int
        versionName <span class="token constant">LIBRARY_VERSION_NAME</span>

        buildConfigField <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;STREAMING_URL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;&quot;</span> <span class="token operator">+</span> <span class="token function">getStreamingUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;&quot;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>// local.properties</p> <div class="language-js extra-class"><pre class="language-js"><code>ndk<span class="token punctuation">.</span>dir<span class="token operator">=</span><span class="token operator">/</span>Users<span class="token operator">/</span>hendry<span class="token operator">/</span>Library<span class="token operator">/</span>Android<span class="token operator">/</span>sdk<span class="token operator">/</span>ndk<span class="token operator">-</span>bundle
sdk<span class="token punctuation">.</span>dir<span class="token operator">=</span><span class="token operator">/</span>Users<span class="token operator">/</span>hendry<span class="token operator">/</span>Library<span class="token operator">/</span>Android<span class="token operator">/</span>sdk
streaming_url<span class="token operator">=</span>rtmp<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.12</span><span class="token number">.126</span><span class="token punctuation">:</span><span class="token number">1935</span><span class="token operator">/</span>rtmplive<span class="token operator">/</span>demo
</code></pre></div><p>// 输出的文件</p> <p>/android_workspace/RtmpPublisher/app/build/generated/source/buildConfig/debug/com/takusemba/rtmppublishersample/BuildConfig.java</p> <p>当中就有输出我们定义的 <code>STREAMING_URL</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Automatically generated file. DO NOT MODIFY
 */</span>
<span class="token keyword">package</span> com<span class="token punctuation">.</span>takusemba<span class="token punctuation">.</span>rtmppublishersample<span class="token punctuation">;</span>

<span class="token keyword">public</span> final <span class="token keyword">class</span> <span class="token class-name">BuildConfig</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> final boolean <span class="token constant">DEBUG</span> <span class="token operator">=</span> Boolean<span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> final String <span class="token constant">APPLICATION_ID</span> <span class="token operator">=</span> <span class="token string">&quot;com.takusemba.rtmppublishersample&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> final String <span class="token constant">BUILD_TYPE</span> <span class="token operator">=</span> <span class="token string">&quot;debug&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> final String <span class="token constant">FLAVOR</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> final int <span class="token constant">VERSION_CODE</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> final String <span class="token constant">VERSION_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;1.1.3&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// Fields from default config.</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> final String <span class="token constant">STREAMING_URL</span> <span class="token operator">=</span> <span class="token string">&quot;rtmp://192.168.12.126:1935/rtmplive/demo&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="sdk-mips-问题"><a href="#sdk-mips-问题" aria-hidden="true" class="header-anchor">#</a> sdk mips 问题</h3> <p>rtmpdump-android 始终编译失败, 即使用老版本的 ndk 而且这个 ndk 目录要 1 个多 g, 可以考虑删除</p> <p>ERROR: Unable to find toolchain: /Users/hendry/Library/Android/sdk/ndk-bundle/toolchains/mipsel-linux-android-4.9/prebuilt</p> <p>https://stackoverflow.com/questions/35128229/error-no-toolchains-found-in-the-ndk-toolchains-folder-for-abi-with-prefix-llv/37409748</p> <p>新版本的 ndk 已经不提供 mips 构架的编译工具链, 所以找不到 mips 的 toolschains</p> <p>一般只需要在 build.gradle 文件中添加 packagingOptions 来忽略 mips 构架就可以了</p> <p>但是有的项目使用的 gradle 版本很低, 就没有这个配置项, 配置后提示错误</p> <p>如果修改 gradle-wrapper.properties 换成新的 gradle 版本 , 那么老的配置文件也有问题</p> <p>于是尝试对这个项目使用老版本的 ndk</p> <p>https://stackoverflow.com/questions/38969500/error1-0-plugin-with-id-com-android-model-application-not-found</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f8bee57c.js" defer></script><script src="/assets/js/44.ea91f873.js" defer></script>
  </body>
</html>
