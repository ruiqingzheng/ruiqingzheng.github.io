(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{184:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"你真的会使用xmlhttprequest吗？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#你真的会使用xmlhttprequest吗？","aria-hidden":"true"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://segmentfault.com/a/1190000004322487",target:"_blank",rel:"noopener noreferrer"}},[t._v("你真的会使用XMLHttpRequest吗？"),s("OutboundLink")],1)]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),s("blockquote",[s("p",[t._v("以下是我认为对"),s("code",[t._v("Ajax")]),t._v("较为准确的解释：（摘自"),s("a",{attrs:{href:"http://www.tutorialspoint.com/ajax/what_is_ajax.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("what is Ajax"),s("OutboundLink")],1),t._v("）\nAJAX stands for Asynchronous JavaScript and XML. AJAX is a new technique for creating better, faster, and more interactive web applications with the help of XML, HTML, CSS, and Java Script.")]),t._v(" "),s("p",[t._v("AJAX is based on the following open standards:")]),t._v(" "),t._m(3)]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),s("p",[s("code",[t._v("XMLHttpRequest")]),t._v("一开始只是微软浏览器提供的一个接口，后来各大浏览器纷纷效仿也提供了这个接口，再后来W3C对它进行了标准化，提出了"),s("a",{attrs:{href:"https://www.w3.org/TR/XMLHttpRequest/",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("XMLHttpRequest")]),t._v("标准"),s("OutboundLink")],1),t._v("。"),s("code",[t._v("XMLHttpRequest")]),t._v("标准又分为"),s("code",[t._v("Level 1")]),t._v("和"),s("code",[t._v("Level 2")]),t._v("。\n"),s("code",[t._v("XMLHttpRequest Level 1")]),t._v("主要存在以下缺点：")]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),s("p",[t._v("当然更详细的对比介绍，可以参考"),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阮老师的这篇文章"),s("OutboundLink")],1),t._v("，文章中对新增的功能都有具体代码示例。")]),t._v(" "),t._m(10),t._v(" "),s("p",[t._v("关于"),s("code",[t._v("xhr")]),t._v("的浏览器兼容性，大家可以直接查看“Can I use”这个网站提供的结果"),s("a",{attrs:{href:"http://caniuse.com/#search=XMLHttpRequest",target:"_blank",rel:"noopener noreferrer"}},[t._v("XMLHttpRequest兼容性"),s("OutboundLink")],1),t._v("，下面提供一个截图。")]),t._v(" "),t._m(11),t._v(" "),s("p",[t._v("从图中可以看到：")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._m(16),t._v(" "),s("hr"),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),s("p",[t._v("在发送"),s("code",[t._v("Ajax")]),t._v("请求（实质是一个"),s("a",{attrs:{href:"http://www.tutorialspoint.com/http/http_header_fields.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP"),s("OutboundLink")],1),t._v("请求）时，我们可能需要设置一些请求头部信息，比如"),s("code",[t._v("content-type")]),t._v("、"),s("code",[t._v("connection")]),t._v("、"),s("code",[t._v("cookie")]),t._v("、"),s("code",[t._v("accept-xxx")]),t._v("等。"),s("code",[t._v("xhr")]),t._v("提供了"),s("code",[t._v("setRequestHeader")]),t._v("来允许我们修改请求 header。")]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),s("p",[t._v("你是否遇到过下面的坑儿?——反正我是遇到了。。。")]),t._v(" "),t._m(27),t._v(" "),s("p",[t._v("经过一番寻找最终在 "),s("a",{attrs:{href:"http://stackoverflow.com/questions/7462968/restrictions-of-xmlhttprequests-getresponseheader",target:"_blank",rel:"noopener noreferrer"}},[t._v("Stack Overflow找到了答案"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("ul",[s("li",[t._v("原因1："),s("a",{attrs:{href:"https://www.w3.org/TR/XMLHttpRequest/",target:"_blank",rel:"noopener noreferrer"}},[t._v("W3C的 xhr 标准中做了限制"),s("OutboundLink")],1),t._v("，规定客户端无法获取 response 中的 "),s("code",[t._v("Set-Cookie")]),t._v("、"),s("code",[t._v("Set-Cookie2")]),t._v("这2个字段，无论是同域还是跨域请求；")]),t._v(" "),s("li",[t._v("原因2："),s("a",{attrs:{href:"https://www.w3.org/TR/cors/#access-control-allow-credentials-response-header",target:"_blank",rel:"noopener noreferrer"}},[t._v("W3C 的 cors 标准对于跨域请求也做了限制"),s("OutboundLink")],1),t._v("，规定对于跨域请求，客户端允许获取的response header字段只限于“"),s("code",[t._v("simple response header")]),t._v("”和“"),s("code",[t._v("Access-Control-Expose-Headers")]),t._v("” （两个名词的解释见下方）。")])]),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),s("p",[t._v("下面是一个获取图片文件的代码示例：")]),t._v(" "),t._m(35),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),t._m(57),t._v(" "),t._m(58),t._v(" "),s("p",[t._v("另外，还有2个需要注意的坑儿：")]),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),t._m(61),t._v(" "),t._m(62),t._v(" "),t._m(63),t._v(" "),s("p",[t._v("在我认真研读W3C 的 xhr 标准前，我总以为同步请求和异步请求只是阻塞和非阻塞的区别，其他什么事件触发、参数设置应该是一样的，事实证明我错了。")]),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._v(" "),t._m(67),t._v(" "),s("p",[t._v("若上面任何一个限制不满足，都会抛错，而对于异步请求，则没有这些参数设置上的限制。")]),t._v(" "),t._m(68),t._v(" "),t._m(69),t._v(" "),t._m(70),t._v(" "),t._m(71),t._v(" "),t._m(72),t._v(" "),t._m(73),t._m(74),t._v(" "),t._m(75),t._v(" "),t._m(76),t._v(" "),t._m(77),t._v(" "),t._m(78),t._v(" "),t._m(79),t._v(" "),t._m(80),t._v(" "),t._m(81),t._v(" "),t._m(82),t._v(" "),t._m(83),t._m(84),t._v(" "),t._m(85),t._v(" "),t._m(86),t._v(" "),t._m(87),t._v(" "),t._m(88),t._v(" "),t._m(89),t._v(" "),t._m(90),t._v(" "),t._m(91),t._v(" "),t._m(92),s("p",[t._v("从代码中我们可以看出：")]),t._v(" "),t._m(93),t._v(" "),t._m(94),t._v(" "),t._m(95),t._v(" "),t._m(96),t._v(" "),t._m(97),t._v(" "),t._m(98),t._v(" "),s("p",[t._v("当请求一切正常时，相关的事件触发顺序如下：")]),t._v(" "),t._m(99),t._v(" "),t._m(100),t._v(" "),t._m(101),t._v(" "),t._m(102),t._v(" "),t._m(103),t._v(" "),t._m(104),t._v(" "),t._m(105),t._m(106),t._v(" "),t._m(107),t._m(108),t._v(" "),t._m(109),t._v(" "),s("p",[t._v("最后给点扩展学习资料，如果你：")]),t._v(" "),s("ul",[s("li",[t._v("想真正搞懂"),s("code",[t._v("XMLHttpRequest")]),t._v("，最靠谱的方法还是看 "),s("a",{attrs:{href:"https://www.w3.org/TR/XMLHttpRequest/",target:"_blank",rel:"noopener noreferrer"}},[t._v("W3C的xhr 标准"),s("OutboundLink")],1),t._v(";")]),t._v(" "),s("li",[t._v("想结合代码学习如何用"),s("code",[t._v("XMLHttpRequest")]),t._v("发各种类型的数据，可以参考"),s("a",{attrs:{href:"http://www.html5rocks.com/zh/tutorials/file/xhr2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("html5rocks上的这篇文章"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("想粗略的了解"),s("code",[t._v("XMLHttpRequest")]),t._v("的基本使用，可以参考"),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN的XMLHttpRequest介绍"),s("OutboundLink")],1),t._v("；")]),t._v(" "),s("li",[t._v("想了解"),s("code",[t._v("XMLHttpRequest")]),t._v(" 的发展历程，可以参考"),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阮老师的文章"),s("OutboundLink")],1),t._v("；")]),t._v(" "),s("li",[t._v("想了解"),s("code",[t._v("Ajax")]),t._v("的基本介绍，可以参考"),s("a",{attrs:{href:"http://www.tutorialspoint.com/ajax/index.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("AJAX Tutorial"),s("OutboundLink")],1),t._v(";")]),t._v(" "),s("li",[t._v("想了解跨域请求，则可以参考"),s("a",{attrs:{href:"https://www.w3.org/TR/cors/",target:"_blank",rel:"noopener noreferrer"}},[t._v("W3C的 cors 标准"),s("OutboundLink")],1),t._v(";")]),t._v(" "),s("li",[t._v("想了解"),s("code",[t._v("http")]),t._v("协议，则可以参考"),s("a",{attrs:{href:"http://www.tutorialspoint.com/http/http_header_fields.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP Tutorial"),s("OutboundLink")],1),t._v(";")])])])},[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("blockquote",[s("p",[t._v("看到标题时，有些同学可能会想：“我已经用"),s("code",[t._v("xhr")]),t._v("成功地发过很多个"),s("code",[t._v("Ajax")]),t._v("请求了，对它的基本操作已经算挺熟练了。” 我之前的想法和你们一样，直到最近我使用"),s("code",[t._v("xhr")]),t._v("时踩了不少坑儿，我才突然发现其实自己并不够了解"),s("code",[t._v("xhr")]),t._v("，我知道的只是最最基本的使用。\n于是我决定好好地研究一番"),s("code",[t._v("xhr")]),t._v("的真面目，可拜读了不少博客后都不甚满意，于是我决定认真阅读一遍W3C的"),s("code",[t._v("XMLHttpRequest")]),t._v("标准。看完标准后我如同醍醐灌顶一般，感觉到了从未有过的清澈。这篇文章就是参考W3C的"),s("code",[t._v("XMLHttpRequest")]),t._v("标准和结合一些实践验证总结而来的。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"ajax和xmlhttprequest"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ajax和xmlhttprequest","aria-hidden":"true"}},[this._v("#")]),this._v(" "),e("code",[this._v("Ajax")]),this._v("和"),e("code",[this._v("XMLHttpRequest")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("我们通常将"),e("code",[this._v("Ajax")]),this._v("等同于"),e("code",[this._v("XMLHttpRequest")]),this._v("，但细究起来它们两个是属于不同维度的2个概念。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Browser-based presentation using HTML and Cascading Style Sheets (CSS).")]),this._v(" "),e("li",[this._v("Data is stored in XML format and fetched from the server.")]),this._v(" "),e("li",[this._v("Behind-the-scenes data fetches using XMLHttpRequest objects in the browser.")]),this._v(" "),e("li",[this._v("JavaScript to make everything happen.")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("从上面的解释中可以知道："),s("code",[t._v("ajax")]),t._v("是一种技术方案，但并不是一种"),s("strong",[t._v("新技术")]),t._v("。它依赖的是现有的"),s("code",[t._v("CSS")]),t._v("/"),s("code",[t._v("HTML")]),t._v("/"),s("code",[t._v("Javascript")]),t._v("，而其中最核心的依赖是浏览器提供的"),s("code",[t._v("XMLHttpRequest")]),t._v("对象，是这个对象使得浏览器可以发出"),s("code",[t._v("HTTP")]),t._v("请求与接收"),s("code",[t._v("HTTP")]),t._v("响应。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("所以我用一句话来总结两者的关系：我们使用"),e("code",[this._v("XMLHttpRequest")]),this._v("对象来发送一个"),e("code",[this._v("Ajax")]),this._v("请求。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"xmlhttprequest的发展历程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xmlhttprequest的发展历程","aria-hidden":"true"}},[this._v("#")]),this._v(" "),e("code",[this._v("XMLHttpRequest")]),this._v("的发展历程")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("受同源策略的限制，不能发送跨域请求；")]),this._v(" "),e("li",[this._v("不能发送二进制文件（如图片、视频、音频等），只能发送纯文本数据；")]),this._v(" "),e("li",[this._v("在发送和获取数据的过程中，无法实时获取进度信息，只能判断是否完成；")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("那么"),e("code",[this._v("Level 2")]),this._v("对"),e("code",[this._v("Level 1")]),this._v(" 进行了改进，"),e("code",[this._v("XMLHttpRequest Level 2")]),this._v("中新增了以下功能：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("可以发送跨域请求，在服务端允许的情况下；")]),t._v(" "),s("li",[t._v("支持发送和接收二进制数据；")]),t._v(" "),s("li",[t._v("新增formData对象，支持发送表单数据；")]),t._v(" "),s("li",[t._v("发送和获取数据时，可以获取进度信息；")]),t._v(" "),s("li",[t._v("可以设置请求的超时时间；")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"xmlhttprequest兼容性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xmlhttprequest兼容性","aria-hidden":"true"}},[this._v("#")]),this._v(" "),e("code",[this._v("XMLHttpRequest")]),this._v("兼容性")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://segmentfault.com/img/bVsiDk",alt:"clipboard.png"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("IE8/IE9、Opera Mini 完全不支持"),s("code",[t._v("xhr")]),t._v("对象")]),t._v(" "),s("li",[t._v("IE10/IE11部分支持，不支持 "),s("code",[t._v("xhr.responseType")]),t._v("为"),s("code",[t._v("json")])]),t._v(" "),s("li",[t._v("部分浏览器不支持设置请求超时，即无法使用"),s("code",[t._v("xhr.timeout")])]),t._v(" "),s("li",[t._v("部分浏览器不支持"),s("code",[t._v("xhr.responseType")]),t._v("为"),s("code",[t._v("blob")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"细说xmlhttprequest如何使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#细说xmlhttprequest如何使用","aria-hidden":"true"}},[this._v("#")]),this._v(" 细说"),e("code",[this._v("XMLHttpRequest")]),this._v("如何使用")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("先来看一段使用"),e("code",[this._v("XMLHttpRequest")]),this._v("发送"),e("code",[this._v("Ajax")]),this._v("请求的简单示例代码。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendAjax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//构造表单数据")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" formData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FormData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  formData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'username'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'johndoe'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  formData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建xhr对象 ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置xhr请求的超时时间")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timeout "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置响应返回的数据格式")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建一个 post 请求，采用异步")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/server'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//注册相关事件回调处理函数")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("ontimeout")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("upload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onprogress")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//发送数据")]),t._v("\n  xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("formData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("上面是一个使用"),e("code",[this._v("xhr")]),this._v("发送表单数据的示例，整个流程可以参考注释。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("接下来我将站在使用者的角度，以问题的形式介绍"),e("code",[this._v("xhr")]),this._v("的基本使用。\n我对每一个问题涉及到的知识点都会进行比较细致地介绍，有些知识点可能是你平时忽略关注的。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"如何设置request-header"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何设置request-header","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何设置request header")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("void setRequestHeader(DOMString header, DOMString value);\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("注意点")]),this._v("：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("方法的第一个参数 header 大小写不敏感，即可以写成"),s("code",[t._v("content-type")]),t._v("，也可以写成"),s("code",[t._v("Content-Type")]),t._v("，甚至写成"),s("code",[t._v("content-Type")]),t._v(";")]),t._v(" "),s("li",[s("code",[t._v("Content-Type")]),t._v("的默认值与具体发送的数据类型有关，请参考本文【可以发送什么类型的数据】一节；")]),t._v(" "),s("li",[s("code",[t._v("setRequestHeader")]),t._v("必须在"),s("code",[t._v("open()")]),t._v("方法之后，"),s("code",[t._v("send()")]),t._v("方法之前调用，否则会抛错；")]),t._v(" "),s("li",[s("code",[t._v("setRequestHeader")]),t._v("可以调用多次，最终的值不会采用覆盖"),s("code",[t._v("override")]),t._v("的方式，而是采用追加"),s("code",[t._v("append")]),t._v("的方式。下面是一个示例代码：")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" client "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'demo.cgi'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'one'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'two'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 最终request header中"X-Test"为: one, two')]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"如何获取response-header"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何获取response-header","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何获取response header")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("xhr")]),t._v("提供了2个用来获取响应头部的方法："),s("code",[t._v("getAllResponseHeaders")]),t._v("和"),s("code",[t._v("getResponseHeader")]),t._v("。前者是获取 response 中的所有header 字段，后者只是获取某个指定 header 字段的值。另外，"),s("code",[t._v("getResponseHeader(header)")]),t._v("的"),s("code",[t._v("header")]),t._v("参数不区分大小写。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("DOMString "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAllResponseHeaders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`\n`")])]),t._v("DOMString "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResponseHeader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DOMString header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("这2个方法看起来简单，但却处处是坑儿。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("使用"),s("code",[t._v("getAllResponseHeaders()")]),t._v("看到的所有"),s("code",[t._v("response header")]),t._v("与实际在控制台 "),s("code",[t._v("Network")]),t._v(" 中看到的 "),s("code",[t._v("response header")]),t._v(" 不一样")]),t._v(" "),s("li",[t._v("使用"),s("code",[t._v("getResponseHeader()")]),t._v("获取某个 "),s("code",[t._v("header")]),t._v(" 的值时，浏览器抛错"),s("code",[t._v('Refused to get unsafe header "XXX"')])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("blockquote",[s("p",[t._v('"'),s("code",[t._v("simple response header")]),t._v('"包括的 header 字段有：'),s("code",[t._v("Cache-Control")]),t._v(","),s("code",[t._v("Content-Language")]),t._v(","),s("code",[t._v("Content-Type")]),t._v(","),s("code",[t._v("Expires")]),t._v(","),s("code",[t._v("Last-Modified")]),t._v(","),s("code",[t._v("Pragma")]),t._v(';\n"'),s("code",[t._v("Access-Control-Expose-Headers")]),t._v('"：首先得注意是"'),s("code",[t._v("Access-Control-Expose-Headers")]),t._v('"进行'),s("strong",[t._v("跨域请求")]),t._v("时响应头部中的一个字段，对于同域请求，响应头部是没有这个字段的。这个字段中列举的 header 字段就是服务器允许暴露给客户端访问的字段。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("所以"),s("code",[t._v("getAllResponseHeaders()")]),t._v("只能拿到"),s("strong",[t._v("限制以外")]),t._v("（即被视为"),s("code",[t._v("safe")]),t._v("）的header字段，而不是全部字段；而调用"),s("code",[t._v("getResponseHeader(header)")]),t._v("方法时，"),s("code",[t._v("header")]),t._v("参数必须是"),s("strong",[t._v("限制以外")]),t._v("的header字段，否则调用就会报"),s("code",[t._v("Refused to get unsafe header")]),t._v("的错误。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"如何指定xhr-response的数据类型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何指定xhr-response的数据类型","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何指定"),e("code",[this._v("xhr.response")]),this._v("的数据类型")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("有些时候我们希望"),s("code",[t._v("xhr.response")]),t._v("返回的就是我们想要的数据类型。比如：响应返回的数据是纯JSON字符串，但我们期望最终通过"),s("code",[t._v("xhr.response")]),t._v("拿到的直接就是一个 js 对象，我们该怎么实现呢？\n有2种方法可以实现，一个是"),s("code",[t._v("level 1")]),t._v("就提供的"),s("code",[t._v("overrideMimeType()")]),t._v("方法，另一个是"),s("code",[t._v("level 2")]),t._v("才提供的"),s("code",[t._v("xhr.responseType")]),t._v("属性。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"xhr-overridemimetype"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xhr-overridemimetype","aria-hidden":"true"}},[this._v("#")]),this._v(" "),e("code",[this._v("xhr.overrideMimeType()")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("overrideMimeType")]),t._v("是"),s("code",[t._v("xhr level 1")]),t._v("就有的方法，所以浏览器兼容性良好。这个方法的作用就是用来重写"),s("code",[t._v("response")]),t._v("的"),s("code",[t._v("content-type")]),t._v("，这样做有什么意义呢？比如：server 端给客户端返回了一份"),s("code",[t._v("document")]),t._v("或者是 "),s("code",[t._v("xml")]),t._v("文档，我们希望最终通过"),s("code",[t._v("xhr.response")]),t._v("拿到的就是一个"),s("code",[t._v("DOM")]),t._v("对象，那么就可以用"),s("code",[t._v("xhr.overrideMimeType('text/xml; charset = utf-8')")]),t._v("来实现。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("再举一个使用场景，我们都知道"),e("code",[this._v("xhr level 1")]),this._v("不支持直接传输blob二进制数据，那如果真要传输 blob 该怎么办呢？当时就是利用"),e("code",[this._v("overrideMimeType")]),this._v("方法来解决这个问题的。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//向 server 端获取一张图片")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/image.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这行是关键！")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将响应数据按照纯文本格式来解析，字符集替换为用户自己定义的字符集")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("overrideMimeType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/plain; charset=x-user-defined'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过 responseText 来获取图片文件对应的二进制字符串")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" binStr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//然后自己再想方法将逐个字节还原为二进制数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" len "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" binStr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" len"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" binStr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("charCodeAt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//String.fromCharCode(c & 0xff);")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" byte "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("代码示例中"),s("code",[t._v("xhr")]),t._v("请求的是一张图片，通过将 "),s("code",[t._v("response")]),t._v(" 的 "),s("code",[t._v("content-type")]),t._v(" 改为'text/plain; charset=x-user-defined'，使得 "),s("code",[t._v("xhr")]),t._v(" 以纯文本格式来解析接收到的blob 数据，最终用户通过"),s("code",[t._v("this.responseText")]),t._v("拿到的就是图片文件对应的二进制字符串，最后再将其转换为 blob 数据。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"xhr-responsetype"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xhr-responsetype","aria-hidden":"true"}},[this._v("#")]),this._v(" "),e("code",[this._v("xhr.responseType")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("responseType")]),t._v("是"),s("code",[t._v("xhr level 2")]),t._v("新增的属性，用来指定"),s("code",[t._v("xhr.response")]),t._v("的数据类型，目前还存在些兼容性问题，可以参考本文的【"),s("code",[t._v("XMLHttpRequest")]),t._v("的兼容性】这一小节。那么"),s("code",[t._v("responseType")]),t._v("可以设置为哪些格式呢，我简单做了一个表，如下：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("code",[t._v("xhr.response")]),t._v(" 数据类型")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v('""')])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("String")]),t._v("字符串")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("默认值(在不设置"),s("code",[t._v("responseType")]),t._v("时)")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v('"text"')])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("String")]),t._v("字符串")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v('"document"')])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("Document")]),t._v("对象")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("希望返回 "),s("code",[t._v("XML")]),t._v(" 格式数据时使用")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v('"json"')])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("javascript")]),t._v(" 对象")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("存在兼容性问题，IE10/IE11不支持")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v('"blob"')])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("Blob")]),t._v("对象")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v('"arrayBuffer"')])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("ArrayBuffer")]),t._v("对象")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("下面是同样是获取一张图片的代码示例，相比"),e("code",[this._v("xhr.overrideMimeType")]),this._v(",用"),e("code",[this._v("xhr.response")]),this._v("来实现简单得多。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/image.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//可以将`xhr.responseType`设置为`"blob"`也可以设置为`" arrayBuffer"`')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//xhr.responseType = 'arrayBuffer';")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'blob'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" blob "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"小结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小结","aria-hidden":"true"}},[this._v("#")]),this._v(" 小结")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("虽然在"),s("code",[t._v("xhr level 2")]),t._v("中，2者是共同存在的。但其实不难发现，"),s("code",[t._v("xhr.responseType")]),t._v("就是用来取代"),s("code",[t._v("xhr.overrideMimeType()")]),t._v("的，"),s("code",[t._v("xhr.responseType")]),t._v("功能强大的多，"),s("code",[t._v("xhr.overrideMimeType()")]),t._v("能做到的"),s("code",[t._v("xhr.responseType")]),t._v("都能做到。所以我们现在完全可以摒弃使用"),s("code",[t._v("xhr.overrideMimeType()")]),t._v("了。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"如何获取response数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何获取response数据","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何获取response数据")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("xhr`提供了3个属性来获取请求返回的数据，分别是：`xhr.response`、`xhr.responseText`、`xhr.responseXML\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("xhr.response")]),t._v(" "),s("ul",[s("li",[t._v("默认值：空字符串"),s("code",[t._v('""')])]),t._v(" "),s("li",[t._v("当请求完成时，此属性才有正确的值")]),t._v(" "),s("li",[t._v("请求未完成时，此属性的值可能是"),s("code",[t._v('""')]),t._v("或者 "),s("code",[t._v("null")]),t._v("，具体与 "),s("code",[t._v("xhr.responseType")]),t._v("有关：当"),s("code",[t._v("responseType")]),t._v("为"),s("code",[t._v('""')]),t._v("或"),s("code",[t._v('"text"')]),t._v("时，值为"),s("code",[t._v('""')]),t._v("；"),s("code",[t._v("responseType")]),t._v("为其他值时，值为 "),s("code",[t._v("null")])])])]),t._v(" "),s("li",[s("code",[t._v("xhr.responseText")]),t._v(" "),s("ul",[s("li",[t._v("默认值为空字符串"),s("code",[t._v('""')])]),t._v(" "),s("li",[t._v("只有当 "),s("code",[t._v("responseType")]),t._v(" 为"),s("code",[t._v('"text"')]),t._v("、"),s("code",[t._v('""')]),t._v("时，"),s("code",[t._v("xhr")]),t._v("对象上才有此属性，此时才能调用"),s("code",[t._v("xhr.responseText")]),t._v("，否则抛错")]),t._v(" "),s("li",[t._v("只有当请求成功时，才能拿到正确值。以下2种情况下值都为空字符串"),s("code",[t._v('""')]),t._v("：请求未完成、请求失败")])])]),t._v(" "),s("li",[s("code",[t._v("xhr.responseXML")]),t._v(" "),s("ul",[s("li",[t._v("默认值为 "),s("code",[t._v("null")])]),t._v(" "),s("li",[t._v("只有当 "),s("code",[t._v("responseType")]),t._v(" 为"),s("code",[t._v('"text"')]),t._v("、"),s("code",[t._v('""')]),t._v("、"),s("code",[t._v('"document"')]),t._v("时，"),s("code",[t._v("xhr")]),t._v("对象上才有此属性，此时才能调用"),s("code",[t._v("xhr.responseXML")]),t._v("，否则抛错")]),t._v(" "),s("li",[t._v("只有当请求成功且返回数据被正确解析时，才能拿到正确值。以下3种情况下值都为"),s("code",[t._v("null")]),t._v("：请求未完成、请求失败、请求成功但返回数据无法被正确解析时")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"如何追踪ajax请求的当前状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何追踪ajax请求的当前状态","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何追踪"),e("code",[this._v("ajax")]),this._v("请求的当前状态")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在发一个"),e("code",[this._v("ajax")]),this._v("请求后，如果想追踪请求当前处于哪种状态，该怎么做呢？")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("用"),s("code",[t._v("xhr.readyState")]),t._v("这个属性即可追踪到。这个属性是只读属性，总共有5种可能值，分别对应"),s("code",[t._v("xhr")]),t._v("不同的不同阶段。每次"),s("code",[t._v("xhr.readyState")]),t._v("的值发生变化时，都会触发"),s("code",[t._v("xhr.onreadystatechange")]),t._v("事件，我们可以在这个事件中进行相关状态判断。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("  xhr.onreadystatechange = function () {\n    switch(xhr.readyState){\n      case 1://OPENED\n        //do something\n            break;\n      case 2://HEADERS_RECEIVED\n        //do something\n        break;\n      case 3://LOADING\n        //do something\n        break;\n      case 4://DONE\n        //do something\n        break;\n    }\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("值")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("状态")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("0")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("UNSENT")]),t._v(" (初始状态，未打开)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("此时"),s("code",[t._v("xhr")]),t._v("对象被成功构造，"),s("code",[t._v("open()")]),t._v("方法还未被调用")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("1")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("OPENED")]),t._v(" (已打开，未发送)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("open()")]),t._v("方法已被成功调用，"),s("code",[t._v("send()")]),t._v("方法还未被调用。注意：只有"),s("code",[t._v("xhr")]),t._v("处于"),s("code",[t._v("OPENED")]),t._v("状态，才能调用"),s("code",[t._v("xhr.setRequestHeader()")]),t._v("和"),s("code",[t._v("xhr.send()")]),t._v(",否则会报错")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("2")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("HEADERS_RECEIVED")]),t._v("(已获取响应头)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("send()")]),t._v("方法已经被调用, 响应头和响应状态已经返回")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("3")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("LOADING")]),t._v(" (正在下载响应体)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("响应体("),s("code",[t._v("response entity body")]),t._v(")正在下载中，此状态下通过"),s("code",[t._v("xhr.response")]),t._v("可能已经有了响应数据")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("4")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("DONE")]),t._v(" (整个数据传输过程结束)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("整个数据传输过程结束，不管本次请求是成功还是失败")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"如何设置请求的超时时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何设置请求的超时时间","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何设置请求的超时时间")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果请求过了很久还没有成功，为了不会白白占用的网络资源，我们一般会主动终止请求。"),e("code",[this._v("XMLHttpRequest")]),this._v("提供了"),e("code",[this._v("timeout")]),this._v("属性来允许设置请求的超时时间。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("xhr.timeout\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("单位：milliseconds 毫秒\n默认值："),e("code",[this._v("0")]),this._v("，即不设置超时")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("很多同学都知道：从"),e("strong",[this._v("请求开始")]),this._v(" 算起，若超过 "),e("code",[this._v("timeout")]),this._v(" 时间请求还没有结束（包括成功/失败），则会触发ontimeout事件，主动结束该请求。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("【那么到底什么时候才算是"),s("strong",[t._v("请求开始")]),t._v(" ？】\n——"),s("code",[t._v("xhr.onloadstart")]),t._v("事件触发的时候，也就是你调用"),s("code",[t._v("xhr.send()")]),t._v("方法的时候。\n因为"),s("code",[t._v("xhr.open()")]),t._v("只是创建了一个连接，但并没有真正开始数据的传输，而"),s("code",[t._v("xhr.send()")]),t._v("才是真正开始了数据的传输过程。只有调用了"),s("code",[t._v("xhr.send()")]),t._v("，才会触发"),s("code",[t._v("xhr.onloadstart")]),t._v(" 。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("【那么什么时候才算是"),e("strong",[this._v("请求结束")]),this._v(" ？】\n—— "),e("code",[this._v("xhr.loadend")]),this._v("事件触发的时候。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("可以在 "),s("code",[t._v("send()")]),t._v("之后再设置此"),s("code",[t._v("xhr.timeout")]),t._v("，但计时起始点仍为调用"),s("code",[t._v("xhr.send()")]),t._v("方法的时刻。")]),t._v(" "),s("li",[t._v("当"),s("code",[t._v("xhr")]),t._v("为一个"),s("code",[t._v("sync")]),t._v("同步请求时，"),s("code",[t._v("xhr.timeout")]),t._v("必须置为"),s("code",[t._v("0")]),t._v("，否则会抛错。原因可以参考本文的【如何发一个同步请求】一节。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"如何发一个同步请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何发一个同步请求","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何发一个同步请求")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("xhr")]),this._v("默认发的是异步请求，但也支持发同步请求（当然实际开发中应该尽量避免使用）。到底是异步还是同步请求，由"),e("code",[this._v("xhr.open（）")]),this._v("传入的"),e("code",[this._v("async")]),this._v("参数决定。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("open(method, url [, async = true [, username = null [, password = null]]])\n")])])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("method")]),t._v(": 请求的方式，如"),s("code",[t._v("GET/POST/HEADER")]),t._v("等，这个参数不区分大小写")]),t._v(" "),s("li",[s("code",[t._v("url")]),t._v(": 请求的地址，可以是相对地址如"),s("code",[t._v("example.php")]),t._v("，这个"),s("strong",[t._v("相对")]),t._v("是相对于当前网页的"),s("code",[t._v("url")]),t._v("路径；也可以是绝对地址如"),s("code",[t._v("http://www.example.com/example.php")])]),t._v(" "),s("li",[s("code",[t._v("async")]),t._v(": 默认值为"),s("code",[t._v("true")]),t._v("，即为异步请求，若"),s("code",[t._v("async=false")]),t._v("，则为同步请求")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("W3C 的 xhr标准中关于"),e("code",[this._v("open()")]),this._v("方法有这样一段说明：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v('Throws an "InvalidAccessError" exception if async is false, the JavaScript global environment is a document environment, and either the timeout attribute is not zero, the withCredentials attribute is true, or the responseType attribute is not the empty string.')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("从上面一段说明可以知道，当"),e("code",[this._v("xhr")]),this._v("为同步请求时，有如下限制：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("xhr.timeout")]),t._v("必须为"),s("code",[t._v("0")])]),t._v(" "),s("li",[s("code",[t._v("xhr.withCredentials")]),t._v("必须为 "),s("code",[t._v("false")])]),t._v(" "),s("li",[s("code",[t._v("xhr.responseType")]),t._v("必须为"),s("code",[t._v('""')]),t._v("（注意置为"),s("code",[t._v('"text"')]),t._v("也不允许）")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("之前说过页面中应该尽量避免使用"),s("code",[t._v("sync")]),t._v("同步请求，为什么呢？\n因为我们无法设置请求超时时间（"),s("code",[t._v("xhr.timeout")]),t._v("为"),s("code",[t._v("0")]),t._v("，即不限时）。在不限制超时的情况下，有可能同步请求一直处于"),s("code",[t._v("pending")]),t._v("状态，服务端迟迟不返回响应，这样整个页面就会一直阻塞，无法响应用户的其他交互。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("另外，标准中并没有提及同步请求时事件触发的限制，但实际开发中我确实遇到过部分应该触发的事件并没有触发的现象。如在 chrome中，当"),s("code",[t._v("xhr")]),t._v("为同步请求时，在"),s("code",[t._v("xhr.readyState")]),t._v("由"),s("code",[t._v("2")]),t._v("变成"),s("code",[t._v("3")]),t._v("时，并不会触发 "),s("code",[t._v("onreadystatechange")]),t._v("事件，"),s("code",[t._v("xhr.upload.onprogress")]),t._v("和 "),s("code",[t._v("xhr.onprogress")]),t._v("事件也不会触发。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"如何获取上传、下载的进度"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何获取上传、下载的进度","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何获取上传、下载的进度")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在上传或者下载比较大的文件时，实时显示当前的上传、下载进度是很普遍的产品需求。\n我们可以通过"),e("code",[this._v("onprogress")]),this._v("事件来实时显示进度，默认情况下这个事件每50ms触发一次。需要注意的是，上传过程和下载过程触发的是不同对象的"),e("code",[this._v("onprogress")]),this._v("事件：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("上传触发的是"),s("code",[t._v("xhr.upload")]),t._v("对象的 "),s("code",[t._v("onprogress")]),t._v("事件")]),t._v(" "),s("li",[t._v("下载触发的是"),s("code",[t._v("xhr")]),t._v("对象的"),s("code",[t._v("onprogress")]),t._v("事件")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("xhr.onprogress = updateProgress;\nxhr.upload.onprogress = updateProgress;\nfunction updateProgress(event) {\n    if (event.lengthComputable) {\n      var completedPercent = event.loaded / event.total;\n    }\n }\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"可以发送什么类型的数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#可以发送什么类型的数据","aria-hidden":"true"}},[this._v("#")]),this._v(" 可以发送什么类型的数据")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("void send(data);")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("xhr.send(data)")]),this._v("的参数data可以是以下几种类型：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("ArrayBuffer")])]),t._v(" "),s("li",[s("code",[t._v("Blob")])]),t._v(" "),s("li",[s("code",[t._v("Document")])]),t._v(" "),s("li",[s("code",[t._v("DOMString")])]),t._v(" "),s("li",[s("code",[t._v("FormData")])]),t._v(" "),s("li",[s("code",[t._v("null")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("如果是 GET/HEAD请求，"),s("code",[t._v("send()")]),t._v("方法一般不传参或传 "),s("code",[t._v("null")]),t._v("。不过即使你真传入了参数，参数也最终被忽略，"),s("code",[t._v("xhr.send(data)")]),t._v("中的data会被置为 "),s("code",[t._v("null")]),t._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("xhr.send(data)")]),this._v("中data参数的数据类型会影响请求头部"),e("code",[this._v("content-type")]),this._v("的默认值：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("如果"),s("code",[t._v("data")]),t._v("是 "),s("code",[t._v("Document")]),t._v(" 类型，同时也是"),s("code",[t._v("HTML Document")]),t._v("类型，则"),s("code",[t._v("content-type")]),t._v("默认值为"),s("code",[t._v("text/html;charset=UTF-8")]),t._v(";否则为"),s("code",[t._v("application/xml;charset=UTF-8")]),t._v("；")]),t._v(" "),s("li",[t._v("如果"),s("code",[t._v("data")]),t._v("是 "),s("code",[t._v("DOMString")]),t._v(" 类型，"),s("code",[t._v("content-type")]),t._v("默认值为"),s("code",[t._v("text/plain;charset=UTF-8")]),t._v("；")]),t._v(" "),s("li",[t._v("如果"),s("code",[t._v("data")]),t._v("是 "),s("code",[t._v("FormData")]),t._v(" 类型，"),s("code",[t._v("content-type")]),t._v("默认值为"),s("code",[t._v("multipart/form-data; boundary=[xxx]")])]),t._v(" "),s("li",[t._v("如果"),s("code",[t._v("data")]),t._v("是其他类型，则不会设置"),s("code",[t._v("content-type")]),t._v("的默认值")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当然这些只是"),e("code",[this._v("content-type")]),this._v("的默认值，但如果用"),e("code",[this._v("xhr.setRequestHeader()")]),this._v("手动设置了中"),e("code",[this._v("content-type")]),this._v("的值，以上默认值就会被覆盖。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("另外需要注意的是，若在断网状态下调用"),s("code",[t._v("xhr.send(data)")]),t._v("方法，则会抛错："),s("code",[t._v("Uncaught NetworkError: Failed to execute 'send' on 'XMLHttpRequest'")]),t._v("。一旦程序抛出错误，如果不 catch 就无法继续执行后面的代码，所以调用 "),s("code",[t._v("xhr.send(data)")]),t._v("方法时，应该用 "),s("code",[t._v("try-catch")]),t._v("捕捉错误。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("try{\n    xhr.send(data)\n  }catch(e) {\n    //doSomething...\n  };\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"xhr-withcredentials与-cors-什么关系"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xhr-withcredentials与-cors-什么关系","aria-hidden":"true"}},[this._v("#")]),this._v(" "),e("code",[this._v("xhr.withCredentials")]),this._v("与 "),e("code",[this._v("CORS")]),this._v(" 什么关系")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("blockquote",[s("p",[t._v("我们都知道，在发同域请求时，浏览器会将"),s("code",[t._v("cookie")]),t._v("自动加在"),s("code",[t._v("request header")]),t._v("中。但大家是否遇到过这样的场景：在发送跨域请求时，"),s("code",[t._v("cookie")]),t._v("并没有自动加在"),s("code",[t._v("request header")]),t._v("中。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("造成这个问题的原因是：在"),s("code",[t._v("CORS")]),t._v("标准中做了规定，默认情况下，浏览器在发送跨域请求时，不能发送任何认证信息（"),s("code",[t._v("credentials")]),t._v('）如"'),s("code",[t._v("cookies")]),t._v('"和"'),s("code",[t._v("HTTP authentication schemes")]),t._v('"。除非'),s("code",[t._v("xhr.withCredentials")]),t._v("为"),s("code",[t._v("true")]),t._v("（"),s("code",[t._v("xhr")]),t._v("对象有一个属性叫"),s("code",[t._v("withCredentials")]),t._v("，默认值为"),s("code",[t._v("false")]),t._v("）。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("所以根本原因是"),s("code",[t._v("cookies")]),t._v("也是一种认证信息，在跨域请求中，"),s("code",[t._v("client")]),t._v("端必须手动设置"),s("code",[t._v("xhr.withCredentials=true")]),t._v("，且"),s("code",[t._v("server")]),t._v("端也必须允许"),s("code",[t._v("request")]),t._v("能携带认证信息（即"),s("code",[t._v("response header")]),t._v("中包含"),s("code",[t._v("Access-Control-Allow-Credentials:true")]),t._v("），这样浏览器才会自动将"),s("code",[t._v("cookie")]),t._v("加在"),s("code",[t._v("request header")]),t._v("中。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("另外，要特别注意一点，一旦跨域"),s("code",[t._v("request")]),t._v("能够携带认证信息，"),s("code",[t._v("server")]),t._v("端一定不能将"),s("code",[t._v("Access-Control-Allow-Origin")]),t._v("设置为"),s("code",[t._v("*")]),t._v("，而必须设置为请求页面的域名。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"xhr相关事件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xhr相关事件","aria-hidden":"true"}},[this._v("#")]),this._v(" "),e("code",[this._v("xhr")]),this._v("相关事件")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"事件分类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#事件分类","aria-hidden":"true"}},[this._v("#")]),this._v(" 事件分类")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("xhr")]),this._v("相关事件有很多，有时记起来还挺容易混乱。但当我了解了具体代码实现后，就容易理清楚了。下面是"),e("code",[this._v("XMLHttpRequest")]),this._v("的部分实现代码：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("interface XMLHttpRequestEventTarget : EventTarget {\n  // event handlers\n  attribute EventHandler onloadstart;\n  attribute EventHandler onprogress;\n  attribute EventHandler onabort;\n  attribute EventHandler onerror;\n  attribute EventHandler onload;\n  attribute EventHandler ontimeout;\n  attribute EventHandler onloadend;\n};\n\ninterface XMLHttpRequestUpload : XMLHttpRequestEventTarget {\n\n};\n\ninterface XMLHttpRequest : XMLHttpRequestEventTarget {\n  // event handler\n  attribute EventHandler onreadystatechange;\n  readonly attribute XMLHttpRequestUpload upload;\n};\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("code",[t._v("XMLHttpRequestEventTarget")]),t._v("接口定义了7个事件：\n"),s("ul",[s("li",[s("code",[t._v("onloadstart")])]),t._v(" "),s("li",[s("code",[t._v("onprogress")])]),t._v(" "),s("li",[s("code",[t._v("onabort")])]),t._v(" "),s("li",[s("code",[t._v("ontimeout")])]),t._v(" "),s("li",[s("code",[t._v("onerror")])]),t._v(" "),s("li",[s("code",[t._v("onload")])]),t._v(" "),s("li",[s("code",[t._v("onloadend")])])])]),t._v(" "),s("li",[t._v("每一个"),s("code",[t._v("XMLHttpRequest")]),t._v("里面都有一个"),s("code",[t._v("upload")]),t._v("属性，而"),s("code",[t._v("upload")]),t._v("是一个"),s("code",[t._v("XMLHttpRequestUpload")]),t._v("对象")]),t._v(" "),s("li",[s("code",[t._v("XMLHttpRequest")]),t._v("和"),s("code",[t._v("XMLHttpRequestUpload")]),t._v("都继承了同一个"),s("code",[t._v("XMLHttpRequestEventTarget")]),t._v("接口，所以"),s("code",[t._v("xhr")]),t._v("和"),s("code",[t._v("xhr.upload")]),t._v("都有第一条列举的7个事件")]),t._v(" "),s("li",[s("code",[t._v("onreadystatechange")]),t._v("是"),s("code",[t._v("XMLHttpRequest")]),t._v("独有的事件")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("所以这么一看就很清晰了：\n"),s("code",[t._v("xhr")]),t._v("一共有8个相关事件：7个"),s("code",[t._v("XMLHttpRequestEventTarget")]),t._v("事件+1个独有的"),s("code",[t._v("onreadystatechange")]),t._v("事件；而"),s("code",[t._v("xhr.upload")]),t._v("只有7个"),s("code",[t._v("XMLHttpRequestEventTarget")]),t._v("事件。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"事件触发条件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#事件触发条件","aria-hidden":"true"}},[this._v("#")]),this._v(" 事件触发条件")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("下面是我自己整理的一张"),e("code",[this._v("xhr")]),this._v("相关事件触发条件表，其中最需要注意的是 "),e("code",[this._v("onerror")]),this._v(" 事件的触发条件。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("事件")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("触发条件")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("onreadystatechange")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("每当"),s("code",[t._v("xhr.readyState")]),t._v("改变时触发；但"),s("code",[t._v("xhr.readyState")]),t._v("由非"),s("code",[t._v("0")]),t._v("值变为"),s("code",[t._v("0")]),t._v("时不触发。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("onloadstart")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("调用"),s("code",[t._v("xhr.send()")]),t._v("方法后立即触发，若"),s("code",[t._v("xhr.send()")]),t._v("未被调用则不会触发此事件。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("onprogress")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("xhr.upload.onprogress")]),t._v("在上传阶段(即"),s("code",[t._v("xhr.send()")]),t._v("之后，"),s("code",[t._v("xhr.readystate=2")]),t._v("之前)触发，每50ms触发一次；"),s("code",[t._v("xhr.onprogress")]),t._v("在下载阶段（即"),s("code",[t._v("xhr.readystate=3")]),t._v("时）触发，每50ms触发一次。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("onload")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("当请求成功完成时触发，此时"),s("code",[t._v("xhr.readystate=4")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("onloadend")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("当请求结束（包括请求成功和请求失败）时触发")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("onabort")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("当调用"),s("code",[t._v("xhr.abort()")]),t._v("后触发")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("ontimeout")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("xhr.timeout")]),t._v("不等于0，由请求开始即"),s("code",[t._v("onloadstart")]),t._v("开始算起，当到达"),s("code",[t._v("xhr.timeout")]),t._v("所设置时间请求还未结束即"),s("code",[t._v("onloadend")]),t._v("，则触发此事件。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("onerror")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("在请求过程中，若发生"),s("code",[t._v("Network error")]),t._v("则会触发此事件（若发生"),s("code",[t._v("Network error")]),t._v("时，上传还没有结束，则会先触发"),s("code",[t._v("xhr.upload.onerror")]),t._v("，再触发"),s("code",[t._v("xhr.onerror")]),t._v("；若发生"),s("code",[t._v("Network error")]),t._v("时，上传已经结束，则只会触发"),s("code",[t._v("xhr.onerror")]),t._v("）。"),s("strong",[t._v("注意")]),t._v("，只有发生了网络层级别的异常才会触发此事件，对于应用层级别的异常，如响应返回的"),s("code",[t._v("xhr.statusCode")]),t._v("是"),s("code",[t._v("4xx")]),t._v("时，并不属于"),s("code",[t._v("Network error")]),t._v("，所以不会触发"),s("code",[t._v("onerror")]),t._v("事件，而是会触发"),s("code",[t._v("onload")]),t._v("事件。")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"事件触发顺序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#事件触发顺序","aria-hidden":"true"}},[this._v("#")]),this._v(" 事件触发顺序")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("触发"),s("code",[t._v("xhr.onreadystatechange")]),t._v("(之后每次"),s("code",[t._v("readyState")]),t._v("变化时，都会触发一次)")]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.onloadstart")]),t._v("\n//上传阶段开始：")]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.upload.onloadstart")])]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.upload.onprogress")])]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.upload.onload")])]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.upload.onloadend")]),t._v("\n//上传结束，下载阶段开始：")]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.onprogress")])]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.onload")])]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.onloadend")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("h4",{attrs:{id:"发生abort-timeout-error异常的处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发生abort-timeout-error异常的处理","aria-hidden":"true"}},[t._v("#")]),t._v(" 发生"),s("code",[t._v("abort")]),t._v("/"),s("code",[t._v("timeout")]),t._v("/"),s("code",[t._v("error")]),t._v("异常的处理")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("在请求的过程中，有可能发生 "),s("code",[t._v("abort")]),t._v("/"),s("code",[t._v("timeout")]),t._v("/"),s("code",[t._v("error")]),t._v("这3种异常。那么一旦发生这些异常，"),s("code",[t._v("xhr")]),t._v("后续会进行哪些处理呢？后续处理如下：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("一旦发生"),s("code",[t._v("abort")]),t._v("或"),s("code",[t._v("timeout")]),t._v("或"),s("code",[t._v("error")]),t._v("异常，先立即中止当前请求")]),t._v(" "),s("li",[t._v("将 "),s("code",[t._v("readystate")]),t._v(" 置为"),s("code",[t._v("4")]),t._v("，并触发 "),s("code",[t._v("xhr.onreadystatechange")]),t._v("事件")]),t._v(" "),s("li",[t._v("如果上传阶段还没有结束，则依次触发以下事件：\n"),s("ul",[s("li",[s("code",[t._v("xhr.upload.onprogress")])]),t._v(" "),s("li",[s("code",[t._v("xhr.upload.[onabort或ontimeout或onerror]")])]),t._v(" "),s("li",[s("code",[t._v("xhr.upload.onloadend")])])])]),t._v(" "),s("li",[t._v("触发 "),s("code",[t._v("xhr.onprogress")]),t._v("事件")]),t._v(" "),s("li",[t._v("触发 "),s("code",[t._v("xhr.[onabort或ontimeout或onerror]")]),t._v("事件")]),t._v(" "),s("li",[t._v("触发"),s("code",[t._v("xhr.onloadend")]),t._v(" 事件")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"在哪个xhr事件中注册成功回调？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在哪个xhr事件中注册成功回调？","aria-hidden":"true"}},[this._v("#")]),this._v(" 在哪个"),e("code",[this._v("xhr")]),this._v("事件中注册成功回调？")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("从上面介绍的事件中，可以知道若"),s("code",[t._v("xhr")]),t._v("请求成功，就会触发"),s("code",[t._v("xhr.onreadystatechange")]),t._v("和"),s("code",[t._v("xhr.onload")]),t._v("两个事件。 那么我们到底要将成功回调注册在哪个事件中呢？我倾向于 "),s("code",[t._v("xhr.onload")]),t._v("事件，因为"),s("code",[t._v("xhr.onreadystatechange")]),t._v("是每次"),s("code",[t._v("xhr.readyState")]),t._v("变化时都会触发，而不是"),s("code",[t._v("xhr.readyState=4")]),t._v("时才触发。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("xhr.onload = function () {\n    //如果请求成功\n    if(xhr.status == 200){\n      //do successCallback\n    }\n  }\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("上面的示例代码是很常见的写法：先判断"),s("code",[t._v("http")]),t._v("状态码是否是"),s("code",[t._v("200")]),t._v("，如果是，则认为请求是成功的，接着执行成功回调。这样的判断是有坑儿的，比如当返回的"),s("code",[t._v("http")]),t._v("状态码不是"),s("code",[t._v("200")]),t._v("，而是"),s("code",[t._v("201")]),t._v("时，请求虽然也是成功的，但并没有执行成功回调逻辑。所以更靠谱的判断方法应该是：当"),s("code",[t._v("http")]),t._v("状态码为"),s("code",[t._v("2xx")]),t._v("或"),s("code",[t._v("304")]),t._v("时才认为成功。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("  xhr.onload = function () {\n    //如果请求成功\n    if((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304){\n      //do successCallback\n    }\n  }\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"结语"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#结语","aria-hidden":"true"}},[this._v("#")]),this._v(" 结语")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("终于写完了......\n看完那一篇长长的W3C的xhr 标准，我眼睛都花了......\n希望这篇总结能帮助刚开始接触"),e("code",[this._v("XMLHttpRequest")]),this._v("的你。")])}],!1,null,null,null);e.default=n.exports}}]);