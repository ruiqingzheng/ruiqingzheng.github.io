(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{222:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署","aria-hidden":"true"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),a("p",[t._v("线上测试")]),t._v(" "),a("h2",{attrs:{id:"api-server-的部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-server-的部署","aria-hidden":"true"}},[t._v("#")]),t._v(" API SERVER 的部署")]),t._v(" "),a("p",[t._v("代码本地更新后每次上传到git仓库,")]),t._v(" "),a("p",[t._v("实际的服务器从git下载更新代码, 并自动重启服务")]),t._v(" "),a("p",[a("code",[t._v("http://git.mydoc.io/?t=154712")])]),t._v(" "),a("h3",{attrs:{id:"上传代码到git仓库-配置公钥无密码拉取代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传代码到git仓库-配置公钥无密码拉取代码","aria-hidden":"true"}},[t._v("#")]),t._v(" 上传代码到git仓库, 配置公钥无密码拉取代码")]),t._v(" "),a("p",[t._v("api server代码独立新建个仓库出来 , 用国内的git仓库速度快 gitee.com")]),t._v(" "),a("p",[a("code",[t._v("hendrycode / vivitek_solution_server")])]),t._v(" "),a("p",[t._v("// "),a("code",[t._v("server目录")]),t._v("已经用sourceTree初始化了git仓库\n// 注意这个"),a("code",[t._v("git")]),t._v("仓库是在已有的"),a("code",[t._v("git仓库")]),t._v("下的子目录下")]),t._v(" "),a("p",[a("code",[t._v("git remote add origin https://gitee.com/hendrycode/vivitek_solution_server.git")]),t._v(" "),a("code",[t._v("git push -u origin master")])]),t._v(" "),a("p",[t._v("代码上传后, 服务器上就可以clone下载了, 但是每次下载的时候还需要输入密码, 这样是很不方便的, 要实现自动化部署就必须要用key来进行代码的上传下载")]),t._v(" "),a("p",[t._v("在linux机器上生成公钥, 在以前没有手动创建公钥的时候, linux机器默认是有个私钥的 "),a("code",[t._v("/root/.ssh/id_rsa")])]),t._v(" "),a("p",[t._v("但没有公钥, 我们用命令生成ssh公钥的时候会提示私钥放在哪, 默认还是"),a("code",[t._v("/root/.ssh/id_rsa")]),t._v(", 也就是会覆盖这个文件,")]),t._v(" "),a("p",[t._v("因为系统在需要私钥的时候, 默认就是读取这个文件, 所以我们就保持默认即可")]),t._v(" "),a("p",[t._v("另外就是我们在服务器端生成一次"),a("code",[t._v("公钥/私钥")]),t._v(",  是可以用在多个项目中的,把公钥添加到项目即可")]),t._v(" "),a("p",[t._v("因此尽量把"),a("code",[t._v("秘钥对")]),t._v("保持好且不要再去创建, 那样会导致所有项目都要更新公钥")]),t._v(" "),a("p",[t._v("// 创建"),a("code",[t._v("秘钥对")])]),t._v(" "),a("p",[a("code",[t._v('ssh-keygen -t rsa -C "aliyun server"')]),t._v(" "),a("code",[t._v("ssh-agent -s")]),t._v(" 确认本机"),a("code",[t._v("ssh-agent")]),t._v("在运行")]),t._v(" "),a("p",[t._v("运行完成后\n私钥 "),a("code",[t._v(".ssh/id_rsa")]),t._v("\n公钥 "),a("code",[t._v(".ssh/id_rsa.pub")])]),t._v(" "),a("p",[t._v("// 添加公钥到gitee.com项目\n"),a("code",[t._v("cat ~/.ssh/id_rsa.pub")])]),t._v(" "),a("p",[t._v("测试下\n"),a("code",[t._v("ssh -T git@gitee.com")]),t._v("  返回gitee.com的用户名说明成功")]),t._v(" "),a("p",[t._v("新安装的git, 添加全局git用户信息, 提交的时候这些会显示在"),a("code",[t._v("提交人")]),t._v('\ngit config --global user.name "hendry"\ngit config --global user.mail "supervisitor.cn@gmail.com"')]),t._v(" "),a("p",[t._v("立即让新创建的密钥对在本机生效")]),t._v(" "),a("p",[a("code",[t._v("ssh-add ~/.ssh/id_rsa")])]),t._v(" "),a("p",[a("code",[t._v("http://www.cnblogs.com/Security-Darren/p/4106328.html")])]),t._v(" "),a("p",[t._v("另外还有需要注意的是gitee.com 有个项目公钥, 限制了部署时候只能clone和pull更新")]),t._v(" "),a("p",[t._v("一般情况我们都是在个人设置里面设置的个人公钥, 那样是可读写的, 项目部署公钥更安全")]),t._v(" "),a("p",[t._v("进入仓库, 在项目的管理中加入部署公钥")]),t._v(" "),a("p",[t._v("然后测试克隆,   需要注意的是clone的时候要选择git协议的才能使用ssh公钥")]),t._v(" "),a("p",[t._v("如果clone地址是https那么是无法使用公钥的")]),t._v(" "),a("p",[a("code",[t._v("git clone git@gitee.com:hendrycode/vivitek_solution_server.git")])]),t._v(" "),a("p",[t._v("另外这个仓库是有两个远程仓库的")]),t._v(" "),a("p",[a("code",[t._v("git clone git@bitbucket.org:hendry2008/vivitek_solution_server.git")])]),t._v(" "),a("p",[t._v("我们每次本地开发的时候push会推送到gitee.com和bitbucket.com两个远程仓库,")]),t._v(" "),a("p",[t._v("且这两个都是配置了公钥无密码拉取代码, 当然首选是gitee, 国内应该速度快, 而且它是部署公钥只能读不能写")]),t._v(" "),a("h2",{attrs:{id:"使用pm2-部署项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用pm2-部署项目","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用PM2 部署项目")]),t._v(" "),a("p",[t._v("// 在服务器端安装PM2")]),t._v(" "),a("p",[a("code",[t._v("npm install -g pm2")])]),t._v(" "),a("p",[t._v("// watch表示代码有变更就重新启动")]),t._v(" "),a("p",[a("code",[t._v("pm2 start bin/www --name 'vivitek_solution_server' --watch")])]),t._v(" "),a("p",[t._v("pm2 list   // 查看已经在运行的项目")]),t._v(" "),a("p",[t._v("pm2 delete // 删除再跑的实例")]),t._v(" "),a("p",[t._v("pm2 log vivitek_solution_server // 查看日志, 比如 这里mongo连接不上, 日志就有显示")]),t._v(" "),a("h2",{attrs:{id:"pm2设置node-env环境变量-port-端口等"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2设置node-env环境变量-port-端口等","aria-hidden":"true"}},[t._v("#")]),t._v(" pm2设置NODE_ENV环境变量 PORT 端口等")]),t._v(" "),a("p",[a("code",[t._v("https://www.cnblogs.com/chyingp/p/pm2-documentation.html")])]),t._v(" "),a("p",[t._v("设置自动重启, watch "),a("code",[t._v("routes")]),t._v(" 目录, 当该目录下的文件更新后, 自动重启")]),t._v(" "),a("p",[t._v("注意要设置工作目录"),a("code",[t._v("cwd")]),t._v("后, "),a("code",[t._v("watch")]),t._v("里面的路径才能生效")]),t._v(" "),a("p",[t._v("另外就是我们也只需要对这目录进行watch即可 , 如果是开发需求更新频繁需要重启, 那么索性就用"),a("code",[t._v("nodemon")])]),t._v(" "),a("p",[t._v("pm2的重启是针对线上环境重启当然不需要那么频繁")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution_server"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/root/vivitek_solution_server/bin/www"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"args"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cwd"')]),t._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/root/vivitek_solution_server"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"env"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"NODE_ENV"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"PORT"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"routes"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n")])])]),a("h2",{attrs:{id:"自动部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动部署","aria-hidden":"true"}},[t._v("#")]),t._v(" 自动部署")]),t._v(" "),a("p",[t._v("自动部署指的是本地开发代码变更后 , 让pm2连接到远程服务器且下载代码后自动重启服务端")]),t._v(" "),a("p",[t._v("暂时跳过")]),t._v(" "),a("p",[t._v("PM2 的配置文件\n// ecosystem.json")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"apps"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ice"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// project name")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"server.js"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动脚本")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//"instances" : 2 , //  跑几个实例')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"env"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"COMMON_VARIABLE"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"env_production"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"NODE_ENV"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"deploy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"production"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"user"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"imooc_manager"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 登陆到本机的用户")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"host"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 远程服务器地址")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ref"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"origin/master"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分支")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"repo"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git clone git@gitee.com:hendrycode/vivitek_solution_server.git"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 仓库")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/www/ice/production"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ssh_options"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"StrictHostKeyChecking=no"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 避免clone分支的时候检查host")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"post-deploy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm install"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在每次发布后运行命令, 比如安装依赖")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pre-deploy-local"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"echo 'Deploy done!'\"")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 本地在发布之前运行一些命令, 比如压缩, 编译等等")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"env"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"NODE_ENV"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"mongodb-数据的导出导入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-数据的导出导入","aria-hidden":"true"}},[t._v("#")]),t._v(" mongodb 数据的导出导入")]),t._v(" "),a("p",[a("code",[t._v("http://blog.51yip.com/nosql/1573.html")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("导出\n"),a("code",[t._v("mongodump -h IP --port 端口 -u 用户名 -p 密码 -d 数据库 -o 文件存在路径")])]),t._v(" "),a("p",[t._v("我们导出本地默认端口的数据库, 在本地开发机器linux 192.168.12.222 机器上导出")]),t._v(" "),a("p",[a("code",[t._v("mongodump -d vivitek_solution -o vivitek_solution.db")]),t._v(" // -o 指定输出目录")]),t._v(" "),a("p",[t._v("如果不指定"),a("code",[t._v("-o")]),t._v(" 参数 , 默认会把导出的文件放在当前目录下的dump目录(会自动新建该目录)")])]),t._v(" "),a("li",[a("p",[t._v("导入")]),t._v(" "),a("p",[t._v("先把导出的文件压缩且scp到线上服务器\n"),a("code",[t._v("tar zcvf vivitek_solution.db.tgz vivitek_solution.db")]),t._v(" "),a("code",[t._v("scp -P9999 vivitek_solution.db.tgz msg.qtrouter.com:/root")]),t._v("\n服务器上解压后导入\n"),a("code",[t._v("mongorestore -h IP --port 端口 -u 用户名 -p 密码 -d 数据库 --drop 文件存在路径")])]),t._v(" "),a("p",[t._v("如")]),t._v(" "),a("p",[a("code",[t._v("mongorestore -d vivitek_solution ./vivitek_solution.db/vivitek_solution")])]),t._v(" "),a("p",[t._v("如果要删除后重新恢复则用--drop参数")]),t._v(" "),a("p",[t._v("恢复成功后, mongo 进去看看数据都已经存在了")]),t._v(" "),a("p",[t._v("然后修改server的mongodb连接的代码, 因为本地开发环境mongodb server 是192.168.12.222,\n现在线上服务器和数据库是跑在同个机器上的因此改成"),a("code",[t._v("127.0.0.1")]),t._v(" , 修改后测试 "),a("code",[t._v("http://msg.qtrouter.com:3333/api/product/cates")]),t._v("\n能获取数据说明API 地址可用")])])]),t._v(" "),a("h2",{attrs:{id:"mongodb-账号密码登陆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-账号密码登陆","aria-hidden":"true"}},[t._v("#")]),t._v(" mongodb 账号密码登陆")]),t._v(" "),a("p",[a("code",[t._v("http://blog.51cto.com/hld1992/2074619")]),t._v(" "),a("code",[t._v("https://www.jianshu.com/p/79caa1cc49a5")])]),t._v(" "),a("p",[t._v("在刚安装完毕的时候，MongoDB都默认有一个admin数据库,此时admin数据库是空的,没有记录权限相关的信息。当集合admin.system.users中一个用户都没有时，\n即使mongod启动时添加了—auth参数,如果没有在admin数据库中添加用户,此时不进行任何认证还是可以做任何操作(不管是否是以—auth 参数启动),\n直到在admin.system.users中添加了一个用户。加固的核心是只有在admin.system.users中添加用户之后，mongodb的认证,授权服务才能生效。")]),t._v(" "),a("p",[t._v("centos 默认配置mongodb只在本地127.0.0.1地址监听")]),t._v(" "),a("p",[t._v("首先需要配置数据库服务器需要认证密码 ,  mongod命令行加入启动时参数 "),a("code",[t._v("--auth")]),t._v(", 如")]),t._v(" "),a("p",[a("code",[t._v("mongod -f /etc/mongod.conf --auth")]),t._v("  // 指定配置文件, 指定需要验证登陆数据库")]),t._v(" "),a("p",[t._v("// centos 下修改配置文件开启验证, 在配置了管理员用户后再开启")]),t._v(" "),a("h3",{attrs:{id:"centos-7-开启mongodb-auth参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos-7-开启mongodb-auth参数","aria-hidden":"true"}},[t._v("#")]),t._v(" centos 7 开启mongodb auth参数")]),t._v(" "),a("p",[t._v("这篇是centos7下的操作比较全面, 还包括系统参数的设置")]),t._v(" "),a("p",[a("code",[t._v("https://www.howtoforge.com/tutorial/how-to-install-and-configure-mongodb-on-centos-7/")])]),t._v(" "),a("p",[t._v("// centos 7 "),a("code",[t._v("/usr/lib/systemd/system/mongod.service")])]),t._v(" "),a("p",[t._v("在服务启动文件中找到"),a("code",[t._v("OPTIONS")])]),t._v(" "),a("p",[t._v("改为\n"),a("code",[t._v('OPTIONS=" --auth -f $CONFIGFILE"')])]),t._v(" "),a("p",[t._v("先以非认证方式启动数据库, 然后添加"),a("code",[t._v("管理员用户")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("mongo  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 进入mongo shell")]),t._v("\nuse admin   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用admin数据库")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据实际情况添加管理员用户")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    roles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" role"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userAdminAnyDatabase"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("auth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回1表示成功")]),t._v("\n")])])]),a("p",[t._v("给需要认证的数据库单独添加用户")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("use vivitek_solution\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution_user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0112358"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    roles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("role"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dbOwner"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("auth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution_user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0112358"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("修改密码")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution_user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek0112358"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("auth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution_user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0112358"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//错误")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("auth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution_user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek0112358"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//登陆成功")]),t._v("\n")])])]),a("ul",[a("li",[t._v("设置数据库需要用户验证")])]),t._v(" "),a("p",[a("code",[t._v("/usr/lib/systemd/system/mongod.service")])]),t._v(" "),a("p",[t._v("在服务启动文件中找到OPTIONS")]),t._v(" "),a("p",[t._v("改为\n"),a("code",[t._v('OPTIONS=" --auth -f $CONFIGFILE"')])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("systemctl daemon"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("reload\nsystemctl restart mongod\n")])])]),a("p",[t._v("当重启mongod后, 终端输入mongo进入到mongo shell, 但是此时比如查看数据库  show dbs 会提示错误")]),t._v(" "),a("p",[t._v("我们需要登陆验证")]),t._v(" "),a("p",[a("code",[t._v('db.auth("admin", "password")')]),t._v(" 验证通过后才能进行数据库的操作")]),t._v(" "),a("p",[t._v("那么"),a("code",[t._v("mongoose")]),t._v(" 连接也要修改, 直接参考mongoose官网的文档即可\n"),a("code",[t._v("http://mongoosejs.com/docs/connections.html")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution_user"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pwd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek0112358"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mongo_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`mongodb://")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("pwd"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("port"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("database"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),t._v("\n")])])]),a("h2",{attrs:{id:"mongoose-区分发环境和线上环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongoose-区分发环境和线上环境","aria-hidden":"true"}},[t._v("#")]),t._v(" mongoose 区分发环境和线上环境")]),t._v(" "),a("p",[t._v("思路是这样的, 在启动的时候传递参数给启动文件")]),t._v(" "),a("p",[t._v("启动文件中根据参数来设置环境变量")]),t._v(" "),a("p",[t._v("这样我们在连接数据库的时候, 就可以判断环境变量, 从而设置不同的数据库连接")]),t._v(" "),a("p",[a("code",[t._v("https://blog.xinshangshangxin.com/2015/09/19/node%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%92%8C%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96/")]),t._v(" "),a("code",[t._v("http://fred.itxfd.com/2016/08/10/node-pm2-%E4%BD%BF%E7%94%A8%E5%8F%82%E6%95%B0%E5%92%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/")])]),t._v(" "),a("p",[t._v("// "),a("code",[t._v("vivitek_solution_server.json")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"apps"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vivitek_solution_server"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/root/vivitek_solution_server/bin/www"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"args"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("让pm2读取配置文件启动")]),t._v(" "),a("p",[a("code",[t._v("pm2 start vivitek_solution_server.json")])]),t._v(" "),a("p",[t._v("这样, "),a("code",[t._v("bin/www")]),t._v(" 就能获取到这个参数, 获取到这个参数我们就把node环境设置为product")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" product_argv "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("splice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("product_argv "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production ..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("// "),a("code",[t._v("db.js")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" mongo_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb://192.168.12.222/vivitek"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mongo_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`mongodb://")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("pwd"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("port"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("database"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("参考前面文章其实可以直接使用PM2 传递环境变量, 当然我们这样传递参数的方式也并不冲突")]),t._v(" "),a("p",[t._v("完成部署后测试 "),a("code",[t._v("http://msg.qtrouter.com:3333/api/product/cates/")])]),t._v(" "),a("p",[t._v("对pm2还需要深入使用, 它的参数传递和结合git进行自动部署还是值得使用的")]),t._v(" "),a("h2",{attrs:{id:"app端配置线上的api地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app端配置线上的api地址","aria-hidden":"true"}},[t._v("#")]),t._v(" APP端配置线上的API地址")]),t._v(" "),a("h2",{attrs:{id:"安装node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装node","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装node")]),t._v(" "),a("p",[t._v("按对应版本选择 "),a("code",[t._v("https://nodejs.org/en/download/")])]),t._v(" "),a("p",[t._v("如 linux 64位:")]),t._v(" "),a("p",[a("code",[t._v("https://nodejs.org/dist/v6.10.3/node-v6.10.3-linux-x64.tar.xz")])]),t._v(" "),a("h3",{attrs:{id:"解压"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解压","aria-hidden":"true"}},[t._v("#")]),t._v(" 解压")]),t._v(" "),a("p",[a("code",[t._v("xz -d node-v6.10.3-linux-x64.tar.xz")]),t._v(" "),a("code",[t._v("tar xvf node-v6.10.3-linux-x64.tar")])]),t._v(" "),a("h3",{attrs:{id:"node添加到path"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node添加到path","aria-hidden":"true"}},[t._v("#")]),t._v(" node添加到path")]),t._v(" "),a("p",[t._v("先确认node解压路径")]),t._v(" "),a("p",[a("code",[t._v("/root/soft/node-v6.10.3-linux-x64/bin")])]),t._v(" "),a("p",[t._v("然后在"),a("code",[t._v("/etc/profile")]),t._v("中"),a("code",[t._v("export")]),t._v("的"),a("code",[t._v("上一行")]),t._v("添加 (大概是55行)")]),t._v(" "),a("p",[a("code",[t._v("PATH=$PATH:/root/soft/node-v6.10.3-linux-x64/bin")])]),t._v(" "),a("p",[t._v("然后让path生效 ,  "),a("code",[t._v("source /etc/profile")])]),t._v(" "),a("p",[t._v("此时 node 和 npm 都能像平时一样使用了")])])}],!1,null,null,null);s.default=e.exports}}]);