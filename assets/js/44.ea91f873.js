(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{210:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"录屏"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#录屏","aria-hidden":"true"}},[t._v("#")]),t._v(" 录屏")]),t._v(" "),s("p",[t._v("录屏功能是 android sdk 提供接口实现的")]),t._v(" "),s("p",[t._v("主要用的是 MediaRecorder 这个类, 它很方便的可以用来录屏保存为文件,")]),t._v(" "),s("p",[t._v("而我们推流的话, 是需要得到 H264 裸流, 而 MediaRecorder 使用中并没有直接接触到裸流")]),t._v(" "),s("p",[t._v("在更早版本 andriod 中, 如果不用 MediaRecorder 的话, 录屏保存文件用的是 MediaMuxer 这个类, 其他步骤是一致的")]),t._v(" "),s("p",[t._v("录屏的过程中核心类是 "),s("code",[t._v("MediaProjection")]),t._v(" , 其中的 "),s("code",[t._v("createVirtualDisplay")]),t._v(" 方法 ("),s("code",[t._v("Creates a VirtualDisplay to capture the contents of the screen.")]),t._v("),")]),t._v(" "),s("p",[t._v("而这个方法中的, 需要传递 "),s("code",[t._v("surface")]),t._v(" 参数, "),s("code",[t._v("surface")]),t._v(" 是"),s("code",[t._v("数据消费者")]),t._v(" , 也就是说录屏的数据输出传递给该 "),s("code",[t._v("surface")])]),t._v(" "),s("p",[s("code",[t._v("The surface to which the content of the virtual display should be rendered")])]),t._v(" "),s("p",[t._v("所以 "),s("code",[t._v("createVirtualDisplay")]),t._v(" 传参 "),s("code",[t._v("mediaRecorder.getSurface()")]),t._v(" 即可把录屏流数据传递给 "),s("code",[t._v("mediaRecorder")]),t._v(" 对象中的 surf`ace")]),t._v(" "),s("h2",{attrs:{id:"demo-步骤流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#demo-步骤流程","aria-hidden":"true"}},[t._v("#")]),t._v(" demo 步骤流程")]),t._v(" "),s("p",[t._v("(参考 "),s("code",[t._v("youtube")]),t._v(" 视频 )")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("新建项目， "),s("code",[t._v("emptyActivity")]),t._v("\n使用 "),s("code",[t._v("materialDesign")]),t._v(" 风格控件, 修改 "),s("code",[t._v("gradle")]),t._v(" "),s("code",[t._v("implementation 'com.android.support:design:28.0.0'")])])]),t._v(" "),s("li",[s("p",[t._v("声明权限 "),s("code",[t._v("declare permissions")])])])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("uses-permission")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("android.permission.WRITE_EXTERNAL_STORAGE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("uses-permission")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("android.permission.RECORD_AUDIO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),s("ul",[s("li",[t._v("初始化布局 (design layout)")])]),t._v(" "),s("p",[s("code",[t._v("layout")]),t._v(" 文件中使用 "),s("code",[t._v("VideoView")]),t._v(" 控件和 "),s("code",[t._v("toggleButton")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("activity")])])]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("activity")]),t._v(" 中初始化变量， 申请权限等")]),t._v(" "),s("p",[t._v("主要用到的类有下面几个类， 需要仔细看文档")]),t._v(" "),s("p",[s("code",[t._v("android.media.MediaRecorder")])]),t._v(" "),s("blockquote",[s("blockquote",[s("p",[s("code",[t._v("/reference/android/media/MediaRecorder.html")])])])]),t._v(" "),s("div",{staticClass:"language-s extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('\nUsed to record audio and video. The recording control is based on a simple state machine (see below).\n\nSurface getSurface ()\n\nGets the surface to record from when using SURFACE video source.\n\n            mediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE);\n\nprivate VirtualDisplay createVirtualDisplay() {\nreturn mediaProjection.createVirtualDisplay("MainActivity", DISPLAY_WIDTH, DISPLAY_HEIGHT, mScreenDensity,\nDisplayManager.VIRTUAL_DISPLAY_FLAG_AUTO_MIRROR,\nmediaRecorder.getSurface(), null, null);\n}\n')])])]),s("blockquote",[s("blockquote",[s("p",[s("code",[t._v("/reference/android/app/Activity.html")])])])]),t._v(" "),s("div",{staticClass:"language-s extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\nSometimes you want to get a result back from an activity when it ends.\nFor example, you may start an activity that lets the user pick a person in a list of contacts;\nwhen it ends, it returns the person that was selected.\nTo do this, you call the startActivityForResult(Intent, int) version with a second integer parameter identifying the call.\nThe result will come back through your onActivityResult(int, int, Intent) method.\n")])])]),s("blockquote",[s("blockquote",[s("p",[t._v("activity")])])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyActivity")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Activity")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" PICK_CONTACT_REQUEST "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onKeyDown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" keyCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeyEvent")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("keyCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeyEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("KEYCODE_DPAD_CENTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// When the user center presses, let them pick a contact.")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("startActivityForResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ACTION_PICK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"content://contacts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                 PICK_CONTACT_REQUEST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onActivityResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" requestCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" resultCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("requestCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" PICK_CONTACT_REQUEST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resultCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" RESULT_OK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A contact was picked.  Here we will just display it")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// to the user.")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("startActivity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Intent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ACTION_VIEW"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[s("strong",[t._v("其他直接看代码和文档")])]),t._v(" "),s("h2",{attrs:{id:"debug"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#debug","aria-hidden":"true"}},[t._v("#")]),t._v(" DEBUG")]),t._v(" "),s("h3",{attrs:{id:"debug-surfacemediasource-could-not-be-initialized"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#debug-surfacemediasource-could-not-be-initialized","aria-hidden":"true"}},[t._v("#")]),t._v(" debug "),s("code",[t._v("SurfaceMediaSource could not be initialized")])]),t._v(" "),s("div",{staticClass:"language-s extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("04-13 22:07:11.579 30772-30772/com.hendry.androidrecordscreen\nE/MediaRecorder: SurfaceMediaSource could not be initialized!\n")])])]),s("p",[t._v("提示错误无法初始化 "),s("code",[t._v("SurfaceMediaSource")]),t._v(", 结果是因为没有设置 "),s("code",[t._v("setOutputFile")]),t._v("，")]),t._v(" "),s("p",[t._v("加上这句就好了 "),s("code",[t._v("mediaRecorder.setOutputFile(videoUri);")])]),t._v(" "),s("div",{staticClass:"language-s extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("04-13 23:13:05.518 8346-8346/com.hendry.androidrecordscreen E/System: stat file error, path is /data/app/com.hendry.androidrecordscreen-1/lib/arm64, exception is android.system.ErrnoException: stat failed: ENOENT (No such file or directory)\n")])])]),s("h3",{attrs:{id:"导入-github-上的推流项目时候遇到的一些问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导入-github-上的推流项目时候遇到的一些问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 导入 github 上的推流项目时候遇到的一些问题")]),t._v(" "),s("h4",{attrs:{id:"gradle-版本问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gradle-版本问题","aria-hidden":"true"}},[t._v("#")]),t._v(" gradle 版本问题")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("ERROR"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("The")]),t._v(" versions of the "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Android")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gradle")]),t._v(" plugin and "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gradle")]),t._v(" are not compatible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Please")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" one of the following"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Update")]),t._v(" your plugin "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("This")]),t._v(" will require changes "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("build"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gradle")]),t._v(" due "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" API changes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n")])])]),s("p",[t._v("原因是因为项目的 gradle 配置文件中 classpath 指定了低版本的 gradle, 因此需要把 gradle-wrapper 的版本也降低")]),t._v(" "),s("p",[t._v("一般情况下, 可能一些代码比较久, 于是它的 build.gradle 中配置的 gradle 比较低版本")]),t._v(" "),s("p",[t._v("而项目在导入到 as 的时候, 默认会用比较高的 gradle, 一般都是可以兼容的, 但是在少数情况下会提示错误,")]),t._v(" "),s("p",[t._v("于是需要降低 gradle 版本修改 gradle-wrapper.properties 文件")]),t._v(" "),s("p",[t._v("// project build.gradle")]),t._v(" "),s("p",[s("code",[t._v("classpath 'com.android.tools.build:gradle:3.3.2'")])]),t._v(" "),s("p",[t._v("// gradle-wrapper.properties")]),t._v(" "),s("p",[s("code",[t._v("distributionUrl=https\\://services.gradle.org/distributions/gradle-4.10.1-all.zip")])]),t._v(" "),s("p",[t._v("或者自己手动下载 gradle-wrapper 对应版本的文件")]),t._v(" "),s("p",[t._v("https://www.jianshu.com/p/9acedba802bb")]),t._v(" "),s("p",[t._v("https://stackoverflow.com/questions/42007826/downgrade-gradle-from-3-3-to-2-14-1")]),t._v(" "),s("p",[t._v('If you\'re using the gradle wrapper, then there\'ll be a folder in your project named "gradle" with a subfolder named "wrapper", inside that, there are 2 files:')]),t._v(" "),s("ul",[s("li",[t._v("gradle-wrapper.jar")]),t._v(" "),s("li",[t._v("gradle-wrapper.properties")])]),t._v(" "),s("p",[t._v('Open "gradle-wrapper.properties" and change the place where it says "3.3" to "2.14.1". Then sync gradle, and it will automatically download 2.14.1.')]),t._v(" "),s("p",[t._v("If you're using the new 2.3 Android Studio, you HAVE to use gradle wrapper 3.3, as its the minimum supported gradle wrapper version. If so, then you'll have to download Android Studio 2.2, or fix whatever issue you have in your project that needs gradle wrapper version 2.14.1.")]),t._v(" "),s("p",[t._v("To get more information about whatever the issue is, try running this: ./gradlew clean assemble -stacktrace")]),t._v(" "),s("p",[t._v("That will clean your project, try and compile it, and if/when it fails, it will show you a stacktrace of the error.")]),t._v(" "),s("p",[t._v("http://services.gradle.org/distributions/")]),t._v(" "),s("h3",{attrs:{id:"找不到-aapt-错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#找不到-aapt-错误","aria-hidden":"true"}},[t._v("#")]),t._v(" 找不到 aapt 错误")]),t._v(" "),s("p",[t._v("Could not find com.android.tools.build:aapt2:3.3.2-5309881.")]),t._v(" "),s("p",[t._v("https://stackoverflow.com/questions/55064741/could-not-find-com-android-tools-buildaapt23-3-2-5309881")]),t._v(" "),s("p",[t._v("add the google() in build.gradle")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("allprojects "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    repositories "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("google")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("add "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v(" line\n     "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("jcenter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"ndk-不编译-mips-平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ndk-不编译-mips-平台","aria-hidden":"true"}},[t._v("#")]),t._v(" NDK 不编译 mips 平台")]),t._v(" "),s("p",[t._v("错误提示")]),t._v(" "),s("div",{staticClass:"language-s extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\norg.gradle.api.tasks.TaskExecutionException: Execution failed for task ':app:transformNativeLibsWithStripDebugSymbolForDebug'.\n")])])]),s("p",[s("code",[t._v("https://stackoverflow.com/questions/42739916/aarch64-linux-android-strip-file-missing")])]),t._v(" "),s("div",{staticClass:"language-s extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("\nCaused by: org.gradle.process.internal.ExecException: A problem occurred starting process 'command '/Users/hendry/Library/Android/sdk/ndk-bundle/toolchains/mips64el-linux-android/prebuilt/darwin-x86_64/bin/mips64el-linux-android-strip''\nat org.gradle.process.internal.DefaultExecHandle.execExceptionFor(DefaultExecHandle.java:220)\nat org.gradle.process.internal.DefaultExecHandle.setEndStateInfo(DefaultExecHandle.java:204)\nat org.gradle.process.internal.DefaultExecHandle.failed(DefaultExecHandle.java:340)\nat org.gradle.process.internal.ExecHandleRunner.run(ExecHandleRunner.java:86)\nat org.gradle.internal.operations.BuildOperationIdentifierPreservingRunnable.run(BuildOperationIdentifierPreservingRunnable.java:39)\n")])])]),s("p",[t._v("// 在 "),s("code",[t._v("app module")]),t._v(" 的 "),s("code",[t._v("build.gradle")]),t._v(" 文件中的 android 配置块中添加配置")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("packagingOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    doNotStrip "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*/mips/*.so'")]),t._v("\n    doNotStrip "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*/mips64/*.so'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"buildconfig-使用-gradle-配置文件来定义常量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#buildconfig-使用-gradle-配置文件来定义常量","aria-hidden":"true"}},[t._v("#")]),t._v(" BuildConfig 使用 gradle 配置文件来定义常量")]),t._v(" "),s("p",[t._v("一般 project 的 build.gradle 文件中定义的是项目依赖, 常量不会被定义在这里")]),t._v(" "),s("p",[t._v("而我们的应用代码一般是 app 文件夹, 可能还有相关的项目文件夹, 他们都是 module,")]),t._v(" "),s("p",[t._v("那么定义一些常量, 可以用 gradle 配置文件来定义, 比如 app 相关的常量就定义在 app module 的 build.gradle 文件中")]),t._v(" "),s("p",[t._v("这里以某个项目的 STREAMING_URL 常量为例")]),t._v(" "),s("p",[s("code",[t._v("https://www.jianshu.com/p/3d9b23afe514")])]),t._v(" "),s("p",[t._v("// app module build.gradle")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("android "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    compileSdkVersion "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COMPILE_SDK_VERSION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" int\n    buildToolsVersion "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BUILD_TOOLS_VERSION")]),t._v("\n    defaultConfig "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        applicationId "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.takusemba.rtmppublishersample"')]),t._v("\n\n        minSdkVersion "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MIN_SDK_VERSION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" int\n        targetSdkVersion "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TARGET_SDK_VERSION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" int\n        versionCode "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LIBRARY_VERSION_CODE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" int\n        versionName "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LIBRARY_VERSION_NAME")]),t._v("\n\n        buildConfigField "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"String"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"STREAMING_URL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getStreamingUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\""')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("// local.properties")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("ndk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Users"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("hendry"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Library"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sdk"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ndk"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bundle\nsdk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dir"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Users"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("hendry"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Library"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Android"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sdk\nstreaming_url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rtmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".12")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".126")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1935")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rtmplive"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("demo\n")])])]),s("p",[t._v("// 输出的文件")]),t._v(" "),s("p",[t._v("/android_workspace/RtmpPublisher/app/build/generated/source/buildConfig/debug/com/takusemba/rtmppublishersample/BuildConfig.java")]),t._v(" "),s("p",[t._v("当中就有输出我们定义的 "),s("code",[t._v("STREAMING_URL")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Automatically generated file. DO NOT MODIFY\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("takusemba"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rtmppublishersample"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" final "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" final boolean "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEBUG")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Boolean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseBoolean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" final String "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APPLICATION_ID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.takusemba.rtmppublishersample"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" final String "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BUILD_TYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" final String "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FLAVOR")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" final int "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VERSION_CODE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" final String "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VERSION_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.1.3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Fields from default config.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" final String "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STREAMING_URL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rtmp://192.168.12.126:1935/rtmplive/demo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"sdk-mips-问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sdk-mips-问题","aria-hidden":"true"}},[t._v("#")]),t._v(" sdk mips 问题")]),t._v(" "),s("p",[t._v("rtmpdump-android 始终编译失败, 即使用老版本的 ndk 而且这个 ndk 目录要 1 个多 g, 可以考虑删除")]),t._v(" "),s("p",[t._v("ERROR: Unable to find toolchain: /Users/hendry/Library/Android/sdk/ndk-bundle/toolchains/mipsel-linux-android-4.9/prebuilt")]),t._v(" "),s("p",[t._v("https://stackoverflow.com/questions/35128229/error-no-toolchains-found-in-the-ndk-toolchains-folder-for-abi-with-prefix-llv/37409748")]),t._v(" "),s("p",[t._v("新版本的 ndk 已经不提供 mips 构架的编译工具链, 所以找不到 mips 的 toolschains")]),t._v(" "),s("p",[t._v("一般只需要在 build.gradle 文件中添加 packagingOptions 来忽略 mips 构架就可以了")]),t._v(" "),s("p",[t._v("但是有的项目使用的 gradle 版本很低, 就没有这个配置项, 配置后提示错误")]),t._v(" "),s("p",[t._v("如果修改 gradle-wrapper.properties 换成新的 gradle 版本 , 那么老的配置文件也有问题")]),t._v(" "),s("p",[t._v("于是尝试对这个项目使用老版本的 ndk")]),t._v(" "),s("p",[t._v("https://stackoverflow.com/questions/38969500/error1-0-plugin-with-id-com-android-model-application-not-found")])])}],!1,null,null,null);a.default=n.exports}}]);