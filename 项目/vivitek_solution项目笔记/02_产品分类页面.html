<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>产品分类页面 | 工作笔记</title>
    <meta name="description" content="Hendry的博客">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.eecf6a6a.css" as="style"><link rel="preload" href="/assets/js/app.f8bee57c.js" as="script"><link rel="preload" href="/assets/js/49.713e67fd.js" as="script"><link rel="prefetch" href="/assets/js/10.837bbfd0.js"><link rel="prefetch" href="/assets/js/11.bbd08110.js"><link rel="prefetch" href="/assets/js/12.eb514b46.js"><link rel="prefetch" href="/assets/js/13.e2503408.js"><link rel="prefetch" href="/assets/js/14.d97c0ac2.js"><link rel="prefetch" href="/assets/js/15.baf7986f.js"><link rel="prefetch" href="/assets/js/16.2b12bf6f.js"><link rel="prefetch" href="/assets/js/17.f7e545ac.js"><link rel="prefetch" href="/assets/js/18.70d9230d.js"><link rel="prefetch" href="/assets/js/19.0a61e7ba.js"><link rel="prefetch" href="/assets/js/2.d139c70a.js"><link rel="prefetch" href="/assets/js/20.87141f48.js"><link rel="prefetch" href="/assets/js/21.536e6d3b.js"><link rel="prefetch" href="/assets/js/22.fa3e648a.js"><link rel="prefetch" href="/assets/js/23.f6c367b9.js"><link rel="prefetch" href="/assets/js/24.a8f770f5.js"><link rel="prefetch" href="/assets/js/25.3bb8bbfc.js"><link rel="prefetch" href="/assets/js/26.1c16cfb8.js"><link rel="prefetch" href="/assets/js/27.075df559.js"><link rel="prefetch" href="/assets/js/28.90c1e366.js"><link rel="prefetch" href="/assets/js/29.3145e78e.js"><link rel="prefetch" href="/assets/js/3.de89ea98.js"><link rel="prefetch" href="/assets/js/30.9832e5bd.js"><link rel="prefetch" href="/assets/js/31.2f9a7c5b.js"><link rel="prefetch" href="/assets/js/32.df9181b5.js"><link rel="prefetch" href="/assets/js/33.ec53f96d.js"><link rel="prefetch" href="/assets/js/34.398a7128.js"><link rel="prefetch" href="/assets/js/35.bb1c5a48.js"><link rel="prefetch" href="/assets/js/36.935a5449.js"><link rel="prefetch" href="/assets/js/37.459fef35.js"><link rel="prefetch" href="/assets/js/38.f51023c1.js"><link rel="prefetch" href="/assets/js/39.ed9f7023.js"><link rel="prefetch" href="/assets/js/4.a889cc83.js"><link rel="prefetch" href="/assets/js/40.7959ecc5.js"><link rel="prefetch" href="/assets/js/41.2f350c5b.js"><link rel="prefetch" href="/assets/js/42.3a09f5a5.js"><link rel="prefetch" href="/assets/js/43.b22e3395.js"><link rel="prefetch" href="/assets/js/44.ea91f873.js"><link rel="prefetch" href="/assets/js/45.29363c9f.js"><link rel="prefetch" href="/assets/js/46.45848afe.js"><link rel="prefetch" href="/assets/js/47.309f8db5.js"><link rel="prefetch" href="/assets/js/48.4da217ee.js"><link rel="prefetch" href="/assets/js/5.7183a5fb.js"><link rel="prefetch" href="/assets/js/50.d90574c6.js"><link rel="prefetch" href="/assets/js/51.5190cc6c.js"><link rel="prefetch" href="/assets/js/52.25c37497.js"><link rel="prefetch" href="/assets/js/53.3fea90a3.js"><link rel="prefetch" href="/assets/js/54.d23ad054.js"><link rel="prefetch" href="/assets/js/55.d8ba3a31.js"><link rel="prefetch" href="/assets/js/56.bc578093.js"><link rel="prefetch" href="/assets/js/57.cb8c611e.js"><link rel="prefetch" href="/assets/js/58.4a6efece.js"><link rel="prefetch" href="/assets/js/59.397f12f2.js"><link rel="prefetch" href="/assets/js/6.6621a9ba.js"><link rel="prefetch" href="/assets/js/60.a209bb60.js"><link rel="prefetch" href="/assets/js/61.0a1b1f3b.js"><link rel="prefetch" href="/assets/js/62.a79409e9.js"><link rel="prefetch" href="/assets/js/63.f99fda12.js"><link rel="prefetch" href="/assets/js/64.59a96a9c.js"><link rel="prefetch" href="/assets/js/65.ab4be186.js"><link rel="prefetch" href="/assets/js/66.df4455cd.js"><link rel="prefetch" href="/assets/js/7.a024304b.js"><link rel="prefetch" href="/assets/js/8.be16c405.js"><link rel="prefetch" href="/assets/js/9.37e77487.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eecf6a6a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">工作笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>产品分类页面</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/02_%E4%BA%A7%E5%93%81%E5%88%86%E7%B1%BB%E9%A1%B5%E9%9D%A2.html#loading-的显示" class="sidebar-link">loading 的显示</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="产品分类页面"><a href="#产品分类页面" aria-hidden="true" class="header-anchor">#</a> 产品分类页面</h1> <p>思路:</p> <p>左右联动的滚动效果 , 左侧是分类菜单, 右侧是分类下的产品</p> <p>数据结构:</p> <p>整体来说就是二维数组,  可以理解成group数组, 每个group下面有成员item</p> <p>有了这样的数据结构后, group信息 <code>分类名</code> 这些就作为 <code>左侧菜单数据</code></p> <p>分类下的所有产品就作为右侧滚动内容区域,   最终要实现的就是点击左侧菜单,  右侧滚动到对应的分类</p> <p>如果滑动右侧内容区域, 左侧菜单也要滚动到对应位置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        分类名<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span>
        分类图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
        分类产品<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                产品id<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品model<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                产品id<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品model<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token punctuation">,</span> <span class="token punctuation">{</span>
        分类名<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span>
        分类图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
        分类产品<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                产品id<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品model<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                产品id<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品model<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h1 id="构建api服务器"><a href="#构建api服务器" aria-hidden="true" class="header-anchor">#</a> 构建api服务器</h1> <p>后端api , server 目录 ,  笔记见 <code>后端server.md</code></p> <h1 id="前端设置api访问"><a href="#前端设置api访问" aria-hidden="true" class="header-anchor">#</a> 前端设置API访问</h1> <p><code>npm install axios vuex</code></p> <p>在scr/api 目录结构里添加了config配置site , 方便以后上线更改服务器地址</p> <p>另外开发环境依然要设置proxyTable</p> <p>打包测试的时候再去看优化方法</p> <h1 id="vuex-访问api获取数据"><a href="#vuex-访问api获取数据" aria-hidden="true" class="header-anchor">#</a> vuex 访问api获取数据</h1> <p>这部分直接看代码</p> <h1 id="页面结构"><a href="#页面结构" aria-hidden="true" class="header-anchor">#</a> 页面结构</h1> <p>左侧菜单
div.cates-wrapper
菜单数据 cate.name</p> <p>右侧产品
div.products-wrapper
产品数据 cate.cate_products</p> <p>获取到数据后, 使用demo的stylus, 样式写的很好</p> <p>better-scroll 的用法</p> <p>better-scroll 需要的知识点在这篇文章
<code>https://juejin.im/post/59b777015188257e764c716f</code></p> <p><code>npm install better-scroll</code>
better scroll 可以用api 方式调用, 也可以用组件方式</p> <p>这里参照sell的例子用api的方法</p> <ol><li><p>初始化两个<code>better scroll</code>
当获取到数据的时候, 把<code>分类菜单div</code> 和<code>产品列表div</code> 都进行初始化 <code>new BScroll</code>
初始化的时机
因为在 Vue 模板中列表渲染还没完成时，是没有生成列表 DOM 元素的，所以需要在确保列表渲染完成以后，
才能创建 BScroll 实例，因此在 Vue 中，初始化 BScroll 的最佳时机是 mouted 的 nextTick。</p> <p>当mounted 新建scroll实例后, 超出范围的区块就可见滚动条了</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// methods: </span>
      <span class="token function">__initScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>menuScroll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BScroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>menuScroll <span class="token punctuation">,</span> <span class="token punctuation">{</span>
          click<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>productScroll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BScroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>productScroll<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          click<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

<span class="token comment">//  mounted  </span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">__initScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>      
</code></pre></div><ol start="2"><li>点击菜单, 滚动条跳转到对应分类内容</li></ol> <p>给内容区域设置 <code>ref</code> , 前面已经设置了 <code>productScroll</code> , 只需要调用该内容滚动条 <code>productScroll</code> 调用<code>scrollToElement</code> 方法</p> <p>参数1 : 要滚动到的dom ,  这个dom 可以根据菜单项的index获取 , 因为是对应的</p> <p>参数2 : 滚动的动画时间</p> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token comment">// 当点击菜单则内容滚动条跳转到对应index dom</span>
        <span class="token keyword">let</span> productList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>productScroll<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&quot;product-list-hook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        console.log(productList);</span>
        <span class="token keyword">let</span> el <span class="token operator">=</span> productList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//        console.log(el);</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>productScroll<span class="token punctuation">.</span><span class="token function">scrollToElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>当滚动内容, 菜单则跳转到对应分类</li></ol> <p>它的实现方式是通过,</p> <ul><li><p>监听右侧滚动条<code>productScroll</code>的scroll 事件, 把滚动条的pos.y的位置 , 放到data里面
只要得到了这个滚动条的位置后, 就可以监听这个productScroll的scrollY的位置
注意, 要获取位置, 必须在scroll初始化的时候传递参数 <code>probeType: 3</code>  , 否则scroll事件不会捕获.</p></li> <li><p><code>productListHeight</code> 然后我们要获取<code>productScroll</code> 中的内容高度区间数组,  把每组的内容高度(clientHeight只读)保存到数组中, 这个数组实际就是每组分类的内容显示的高度区间
_calculateHeight 同样放在 mounted 20ms后执行
另外需要注意, 区间的获取 是把<code>上个元素的高度</code> + <code>当前元素的高度</code> ; 假如每组高度100 , 保存后, 区间数组类似[0, 100, 200,300,400]</p></li> <li><p>需要监测productScroll的pos.y的位置来计算当前滚动到了哪个分类
有了<code>scrollY</code>的位置 和 <code>内容高度区间</code>后, 我们就计算判断当前<code>scrollY</code>的位置, 如果在i 和 i+1 两个分组的高度内,  就把i作为index
计算的时候注意 scrollY 是个负数</p></li> <li><p>设置<code>menuScroll[index]</code> 为活动样式
<code>:class=&quot;{'current':currentIndex == index}&quot;</code></p></li></ul> <p>处理最后分内的高度不足的问题 , 当最后一个分类产品高度不够的时候, scroll 是滚动不到这个地方的, 这个是浏览器的scroll 特性决定的, 可以看以前的scroll笔记
所以, 只能把这个分类的高度进行补全,   在mounted 的时候, 计算区间高度的同时 判断这个分类的高度是否匹配scroll的显示高度, 如果不足, 那么就改style, 设置高度</p> <p>整个流程的主要代码</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// __initScroll()  , mounted timeout 20ms的时候调用</span>
<span class="token comment">// 设置 scroll 的type 为3 才能获取到pos.y</span>


    <span class="token keyword">this</span><span class="token punctuation">.</span>productScroll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BScroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>productScroll<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        click<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        probeType<span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 需要监测productScroll的pos.y的位置来计算当前滚动到了哪个分类</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>productScroll<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">pos</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scrollY <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// methods </span>
<span class="token comment">// 点击菜单则滚动到对应区域 </span>

    <span class="token function">selectMenu</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 当点击菜单则内容滚动条跳转到对应index dom</span>
        <span class="token keyword">let</span> productList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>productScroll<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&quot;product-list-hook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> el <span class="token operator">=</span> productList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>productScroll<span class="token punctuation">.</span><span class="token function">scrollToElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>



<span class="token comment">// 统计右侧滚动区域分组的区间高度数组, 且补全最后一个分类的高度</span>
      <span class="token function">_calculateHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> containerHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>productScroll<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>containerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> productList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>productScroll<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&quot;product-list-hook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> length <span class="token operator">=</span> productList<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">// 处理最后一个元素的高度问题</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>productList<span class="token punctuation">[</span>length <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientHeight <span class="token operator">&lt;</span> containerHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          productList<span class="token punctuation">[</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> containerHeight <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>productListHeight<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          height <span class="token operator">+=</span> productList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>clientHeight
          <span class="token keyword">this</span><span class="token punctuation">.</span>productListHeight<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

<span class="token comment">// watch 内容区域的滚动位置, 来设置菜单index</span>

    watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">scrollY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// this.productListHeight,  this.scrollY</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productListHeight<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> height1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productListHeight<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> height2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>productListHeight<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>scrollY <span class="token operator">&gt;=</span> height1 <span class="token operator">&amp;&amp;</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>scrollY <span class="token operator">&lt;</span> height2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 

</code></pre></div><h1 id="加入loading"><a href="#加入loading" aria-hidden="true" class="header-anchor">#</a> 加入loading</h1> <p>loading 组件内部就是一个gif图片  ,    loading组件的位置控制</p> <p>定义loading组件的时候, 外层是div, 里面是img图片,  所以可以设置div为100%的宽度, text-align为居中, 于是loading组件水平居中是没有问题的</p> <p>然后loading组件的垂直的位置, 需要在使用的时候来确定 ,  需要有个<code>loading-container</code> ,</p> <p>然后设置这个<code>container</code> ,     <code>position: absolute , top : 50%</code> , 把这个<code>container</code> 放到了需要放置的区域的垂直中部 , 于是loading也就垂直居中了</p> <p>loading 的使用和调试 , 使用v-show , 注意试试用的v-show , 不是v-if</p> <p>在调试的时候, 去掉v-show 即可看效果 , 确定了位置后, 再加上v-show</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token operator">&lt;</span>div v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">&quot;!cates.length&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;loading-container&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Loading<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Loading<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><h1 id="initscroll-和-calculateheight-的时机问题"><a href="#initscroll-和-calculateheight-的时机问题" aria-hidden="true" class="header-anchor">#</a> initScroll 和_calculateHeight 的时机问题</h1> <p>原本都是放在mounted下面</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">__initScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_calculateHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>但是发现如果从一个页面切换到这个产品分类页面的话, <code>_calculateHeight</code> 会报错, 页面dom没有初始化完毕就调用了clientHeight 报dom元素undefined错误</p> <p>于是换成, 在watch里面 监测 cates数据 (<code>mapGetters</code> 里面的数据) , 当数据获取到后,  timeout 20ms 再去_calculateHeight 于是就没有报错了</p> <p>initScroll 理论上也应该是在dom元素渲染完成后才去初始化scroll , 于是把initScroll的调用, 也放到watch里面</p> <div class="language-js extra-class"><pre class="language-js"><code>watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">cates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">__initScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_calculateHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h1 id="vue-lazyloader-的使用"><a href="#vue-lazyloader-的使用" aria-hidden="true" class="header-anchor">#</a> vue-lazyloader 的使用</h1> <p><code>https://github.com/hilongjw/vue-lazyload</code></p> <p>注意, lazyloader 使用后, 在结合scroll 的时候,  它必须要有滚动才触发load , 所以, 在使用better-scroll 滚动到某个位置的时候scrollToElement,  延时参数要设置大于0 , 否则不会加载</p> <p>可能你不需要有动画, 比如设置100就会有动画, 那么设置为1即可, 那样也是没有滚动动画的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>productScroll<span class="token punctuation">.</span><span class="token function">scrollToElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>场景</p> <p>比如列表, 每个<code>item</code>都要显示<code>网络图片</code>, 这个列表很长,  那么还没有处在<code>显示区域</code>的图片是不需要加载的 , 我们需要这样的<code>图片懒加载</code></p> <ol><li><p>安装依赖
npm install vue-lazyload</p></li> <li><p>main.js中引入, 且设置默认加载图片</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> VueLazyload <span class="token keyword">from</span> <span class="token string">'vue-lazyload'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueLazyload<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  loading<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'common/image/default.png'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>在组件中直接使用指令</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>img <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;avatar&quot;</span> v<span class="token operator">-</span>lazy<span class="token operator">=</span><span class="token string">&quot;item.avatar&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><h1 id="tips"><a href="#tips" aria-hidden="true" class="header-anchor">#</a> Tips</h1> <h2 id="loading-的显示"><a href="#loading-的显示" aria-hidden="true" class="header-anchor">#</a> loading 的显示</h2> <p>以前loading 状态是保存在vuex里面, 获取数据的时候设置loading = true , 数据返回设置loading = false</p> <p>但还有更简便的办法 , 在组件中, 直接判断当前数据长度即可</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token operator">&lt;</span>div v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">&quot;!data.length&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;loading-container&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>loading<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>loading<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f8bee57c.js" defer></script><script src="/assets/js/49.713e67fd.js" defer></script>
  </body>
</html>
