<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>server 提供API数据 | 工作笔记</title>
    <meta name="description" content="Hendry的博客">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.eecf6a6a.css" as="style"><link rel="preload" href="/assets/js/app.f8bee57c.js" as="script"><link rel="preload" href="/assets/js/55.d8ba3a31.js" as="script"><link rel="prefetch" href="/assets/js/10.837bbfd0.js"><link rel="prefetch" href="/assets/js/11.bbd08110.js"><link rel="prefetch" href="/assets/js/12.eb514b46.js"><link rel="prefetch" href="/assets/js/13.e2503408.js"><link rel="prefetch" href="/assets/js/14.d97c0ac2.js"><link rel="prefetch" href="/assets/js/15.baf7986f.js"><link rel="prefetch" href="/assets/js/16.2b12bf6f.js"><link rel="prefetch" href="/assets/js/17.f7e545ac.js"><link rel="prefetch" href="/assets/js/18.70d9230d.js"><link rel="prefetch" href="/assets/js/19.0a61e7ba.js"><link rel="prefetch" href="/assets/js/2.d139c70a.js"><link rel="prefetch" href="/assets/js/20.87141f48.js"><link rel="prefetch" href="/assets/js/21.536e6d3b.js"><link rel="prefetch" href="/assets/js/22.fa3e648a.js"><link rel="prefetch" href="/assets/js/23.f6c367b9.js"><link rel="prefetch" href="/assets/js/24.a8f770f5.js"><link rel="prefetch" href="/assets/js/25.3bb8bbfc.js"><link rel="prefetch" href="/assets/js/26.1c16cfb8.js"><link rel="prefetch" href="/assets/js/27.075df559.js"><link rel="prefetch" href="/assets/js/28.90c1e366.js"><link rel="prefetch" href="/assets/js/29.3145e78e.js"><link rel="prefetch" href="/assets/js/3.de89ea98.js"><link rel="prefetch" href="/assets/js/30.9832e5bd.js"><link rel="prefetch" href="/assets/js/31.2f9a7c5b.js"><link rel="prefetch" href="/assets/js/32.df9181b5.js"><link rel="prefetch" href="/assets/js/33.ec53f96d.js"><link rel="prefetch" href="/assets/js/34.398a7128.js"><link rel="prefetch" href="/assets/js/35.bb1c5a48.js"><link rel="prefetch" href="/assets/js/36.935a5449.js"><link rel="prefetch" href="/assets/js/37.459fef35.js"><link rel="prefetch" href="/assets/js/38.f51023c1.js"><link rel="prefetch" href="/assets/js/39.ed9f7023.js"><link rel="prefetch" href="/assets/js/4.a889cc83.js"><link rel="prefetch" href="/assets/js/40.7959ecc5.js"><link rel="prefetch" href="/assets/js/41.2f350c5b.js"><link rel="prefetch" href="/assets/js/42.3a09f5a5.js"><link rel="prefetch" href="/assets/js/43.b22e3395.js"><link rel="prefetch" href="/assets/js/44.ea91f873.js"><link rel="prefetch" href="/assets/js/45.29363c9f.js"><link rel="prefetch" href="/assets/js/46.45848afe.js"><link rel="prefetch" href="/assets/js/47.309f8db5.js"><link rel="prefetch" href="/assets/js/48.4da217ee.js"><link rel="prefetch" href="/assets/js/49.713e67fd.js"><link rel="prefetch" href="/assets/js/5.7183a5fb.js"><link rel="prefetch" href="/assets/js/50.d90574c6.js"><link rel="prefetch" href="/assets/js/51.5190cc6c.js"><link rel="prefetch" href="/assets/js/52.25c37497.js"><link rel="prefetch" href="/assets/js/53.3fea90a3.js"><link rel="prefetch" href="/assets/js/54.d23ad054.js"><link rel="prefetch" href="/assets/js/56.bc578093.js"><link rel="prefetch" href="/assets/js/57.cb8c611e.js"><link rel="prefetch" href="/assets/js/58.4a6efece.js"><link rel="prefetch" href="/assets/js/59.397f12f2.js"><link rel="prefetch" href="/assets/js/6.6621a9ba.js"><link rel="prefetch" href="/assets/js/60.a209bb60.js"><link rel="prefetch" href="/assets/js/61.0a1b1f3b.js"><link rel="prefetch" href="/assets/js/62.a79409e9.js"><link rel="prefetch" href="/assets/js/63.f99fda12.js"><link rel="prefetch" href="/assets/js/64.59a96a9c.js"><link rel="prefetch" href="/assets/js/65.ab4be186.js"><link rel="prefetch" href="/assets/js/66.df4455cd.js"><link rel="prefetch" href="/assets/js/7.a024304b.js"><link rel="prefetch" href="/assets/js/8.be16c405.js"><link rel="prefetch" href="/assets/js/9.37e77487.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eecf6a6a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">工作笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>server 提供API数据</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#初始化项目" class="sidebar-link">初始化项目</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#mongod-数据库服务端" class="sidebar-link">mongod 数据库服务端</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#mongoose操作数据库" class="sidebar-link">mongoose操作数据库</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#分类数据接口" class="sidebar-link">分类数据接口</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#产品详情数据接口" class="sidebar-link">产品详情数据接口</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#完善更新product数据" class="sidebar-link">完善更新product数据</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#产品详情" class="sidebar-link">产品详情</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#投影距离" class="sidebar-link">投影距离</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#产品详情数据结构更新" class="sidebar-link">产品详情数据结构更新</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#产品api测试地址" class="sidebar-link">产品API测试地址</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#成功案例页面数据" class="sidebar-link">成功案例页面数据</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#案例api测试地址" class="sidebar-link">案例API测试地址</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#售后数据api接口" class="sidebar-link">售后数据API接口</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#售后shema数据结构" class="sidebar-link">售后shema数据结构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#tips" class="sidebar-link">Tips</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#解构操作" class="sidebar-link">解构操作</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#node-path模块" class="sidebar-link">node path模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#批量插入" class="sidebar-link">批量插入</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#判断js对象不为空" class="sidebar-link">判断js对象不为空</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vivitek_solution%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AFserver.html#js-对象的遍历" class="sidebar-link">js 对象的遍历</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="server-提供api数据"><a href="#server-提供api数据" aria-hidden="true" class="header-anchor">#</a> server 提供API数据</h1> <p>express + mongodb</p> <h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <p>参考以前的笔记
<code>no_sql\mongodb_hendry</code>  (mogodb 基础知识)
<code>node_ninja</code> (express+ mongodb 笔记)
<code>auth_demo_vivitek</code> (也有部分mongodb操作)</p> <h2 id="初始化项目"><a href="#初始化项目" aria-hidden="true" class="header-anchor">#</a> 初始化项目</h2> <p>进入到backend目录 (server目录) 执行:
<code>express --view=ejs</code></p> <p>运行后会生成项目基本目录结构 , 包括package配置文件</p> <p>安装依赖:</p> <p><code>npm install</code></p> <p>测试运行 :
<code>npm run start</code> <code>http://localhost:3000/</code></p> <p>安装我们需要的其他的依赖:</p> <p><code>npm install --save connect-multiparty md5</code> <code>npm install --save mongoose</code></p> <p>一般启动需要用到自动刷新 ,  所以我们要用<code>nodemon</code>来启动</p> <p><code>nodemon bin/www</code></p> <p>上线后需要其他工具来启动服务器保证不至于down掉</p> <h2 id="mongod-数据库服务端"><a href="#mongod-数据库服务端" aria-hidden="true" class="header-anchor">#</a> mongod 数据库服务端</h2> <p>mongodb 服务端启动<code>mongod</code>  , 安装和启动服务略</p> <h2 id="mongoose操作数据库"><a href="#mongoose操作数据库" aria-hidden="true" class="header-anchor">#</a> mongoose操作数据库</h2> <ol><li>连接数据库  //  <code>db.js</code> <code>mongoose.connect()</code></li> <li>定义schema       // <code>new Schema({...})</code></li> <li>指定collection , 可以在定义schema的时候指定, 也可以单独设定  // <code>productSchema.set(&quot;collection&quot;, &quot;product&quot;);</code></li> <li>定义model</li></ol> <p>新建model文件夹</p> <ol><li><p>数据库连接
<code>db.js</code> 使用mongoose 建立数据库连接并返回mongoose实例</p> <p><code>http://mongoosejs.com/docs/connections.html</code></p> <p>// <code>db.js</code></p></li> <li><p>根据数据建立<code>model</code></p> <p>cate 表 和 product 表</p></li></ol> <h2 id="分类数据接口"><a href="#分类数据接口" aria-hidden="true" class="header-anchor">#</a> 分类数据接口</h2> <p>访问地址 &quot;/api/product/cates&quot;,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        分类名<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span>
        分类图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
        分类产品<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                产品id<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品model<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                产品id<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品model<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token punctuation">,</span> <span class="token punctuation">{</span>
        分类名<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span>
        分类图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
        分类产品<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                产品id<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品model<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                产品id<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品model<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
                产品图片<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>// 根据 <code>cate_id</code>数组在循环中查询 , 每个循环的异步数据, 返回结果需要存到<code>result数组</code>进行返回
// 但是这个例子中for循环是不能用forEach来替代的, 使用forEach , result 返回是空 , forEach 应该理解为并行的, 于是index判断会不正常
// 所以,  如果必须在循环里调用await, 而且需要判断<code>最后一个回调</code>里面去<code>返回数据</code>的话 , 比较测试下来应该使用<code>for</code>循环,   for of 也不方便判断index , forEach结果是不对的
// 总之如果循环里要用到await的话, 那么循环就使用for , 而不要使用forEach
// <code>async</code> 方法中才能使用<code>await</code>, 如果<code>async</code>要返回数据, 那么要求返回的是<code>promise</code> , 所以这里把最后异步获取到的数据, 用<code>promise</code>包装后返回</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/cates&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> cates <span class="token operator">=</span> <span class="token keyword">await</span> model_cate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// console.log(&quot;cates:&quot;, cates)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> cates<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cate <span class="token operator">=</span> cates<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> products <span class="token operator">=</span> <span class="token keyword">await</span> model_product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>cate_id<span class="token punctuation">:</span> cate<span class="token punctuation">.</span>cate_id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      cate_products<span class="token punctuation">:</span> products<span class="token punctuation">,</span>
      cate_id<span class="token punctuation">:</span> cate<span class="token punctuation">.</span>cate_id<span class="token punctuation">,</span>
      cate_name<span class="token punctuation">:</span> cate<span class="token punctuation">.</span>cate_name<span class="token punctuation">,</span>
      cate_img<span class="token punctuation">:</span> cate<span class="token punctuation">.</span>cate_img
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> cates<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log(result);</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>api_result<span class="token punctuation">.</span><span class="token function">success_response</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="产品详情数据接口"><a href="#产品详情数据接口" aria-hidden="true" class="header-anchor">#</a> 产品详情数据接口</h2> <p>访问地址: <code>/api/product/:id</code></p> <p>产品详情的表结构设计 , 原有的product表结构字段是不够的 , 而nosql的特点,   它是可以存数组的, 存对象的, 因此我们可以把一些字段用数组或对象来存储</p> <p>当前字段</p> <div class="language-js extra-class"><pre class="language-js"><code>        <span class="token string">&quot;cate_id&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;product_id&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;product_model&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;DX761Z-UST&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;product_desc&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;3800超高流明,20000:1高对比度&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;product_img&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;http://www.vivitek.com.cn/ImgUpload/Relate/Big/385X250/20170314095314.jpg&quot;</span><span class="token punctuation">,</span>
</code></pre></div><p>因为这些数据是给分类页面使用的,  并不是详情数据, 这些数据假如先都不变的话,  详情页面需要的数据直接从官网获取, 比如多张图片, 更多的features</p> <p>那么对于这已有的测试数据, 我们需要进行update操作,  把需要的数据从官网提取到文件, 然后读取文件赋值给js变量, 最后把这些js变量直接保存到mongodb</p> <h2 id="完善更新product数据"><a href="#完善更新product数据" aria-hidden="true" class="header-anchor">#</a> 完善更新product数据</h2> <ol><li><p>按需求求该表结构</p> <p>product detail需要显示有的不少组成部分, 于是增加了一些字段, images 产品图片 , features: 产品特点</p> <p>根据官网数据, 规格, 下面有很多参数数据, 这些参数数据都放在了 <code>&quot;parameters&quot; : Object,</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> productSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token string">&quot;product_id&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span>String<span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">&quot;cate_id&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token string">&quot;product_model&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token string">&quot;product_desc&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token string">&quot;product_img&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token string">&quot;product_price&quot;</span><span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
<span class="token string">&quot;images&quot;</span><span class="token punctuation">:</span> Array<span class="token punctuation">,</span>
<span class="token string">&quot;features&quot;</span><span class="token punctuation">:</span> Array<span class="token punctuation">,</span>
<span class="token string">&quot;distance&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token string">&quot;parameters&quot;</span> <span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
<span class="token string">&quot;created&quot;</span> <span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
<span class="token string">&quot;updated&quot;</span><span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>`
</code></pre></div></li> <li><p>参考mongoose文档使用model对象的update方法, 对已有的数据进行更新</p></li></ol> <p>首先需要从官网收集数据 , 然后调用update方法进行更新, 直接看代码  控制器<code>router/test</code>中代码<code>test-update</code></p> <p>以后的产品更新,  可以直接收集这样的文档然后进行更新</p> <h2 id="产品详情"><a href="#产品详情" aria-hidden="true" class="header-anchor">#</a> 产品详情</h2> <p>发现产品详情是用图片做的, 那么我们也只能用图片来做了
增加detail_img 字段</p> <h2 id="投影距离"><a href="#投影距离" aria-hidden="true" class="header-anchor">#</a> 投影距离</h2> <p>投影距离也是图片
修改原本的distance为distance_img字段</p> <h2 id="产品详情数据结构更新"><a href="#产品详情数据结构更新" aria-hidden="true" class="header-anchor">#</a> 产品详情数据结构更新</h2> <p>原本以为每个产品的详情字段都是一致的, 但在录入数据的时候发现以前定义的数据字段, 很多产品的字段都不一样</p> <ol><li><p>比如产品特征, 原本以为都是图片 , 现在才发现有的是文字 ,</p> <p>凡是文字的产品特征, 添加新字段录入  格式:</p> <div class="language-js extra-class"><pre class="language-js"><code>detail_obj <span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;产品最突出的特点&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;全新的激光光源系统&quot;</span> <span class="token punctuation">,</span> <span class="token string">&quot;激光光源, 2万小时使用寿命，省去换灯的繁琐，减少维护费用及时间&quot;</span> <span class="token punctuation">,</span><span class="token string">&quot;快速开机、关机, 令用户、集成商扩展更多的系统设计&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">,</span>
    <span class="token string">&quot;其他功能特点&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'“极致色彩”技术：单片DLP芯片，极致色彩，高亮度，色彩鲜艳度'</span> <span class="token punctuation">,</span> <span class="token string">&quot;具备DICOM模式,适合医疗教育及培训使用&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>比较复杂的是规格参数, 它是个表格, 但是表格的字段名都是不固定的, 于是这个需要想办法可以正确保存和读取到字段名</p></li></ol> <p>我们可以直接用中文的字段名为键值直接把规格参数表格存储为对象, 进行原样输出</p> <pre><code>```js
parameters_origin: {
    &quot;显示技术&quot;: &quot;德州仪器DLP™ 技术&quot;,
    &quot;芯片&quot;: {
        &quot;DMD芯片&quot;: '0.55&quot; XGA×1,DDP4421解码芯片,极致色彩',
        &quot;实际分辨率&quot;: &quot;XGA(1024×768)最高支持WUXGA(1920x1200)@60Hz信号输入&quot;,
        &quot;显示色彩&quot;: '1677万色',
        &quot;色深&quot;: '10比特',
    },
    &quot;色轮&quot;: '色轮',
}
```
</code></pre> <p>前端页面对于<code>parameters_origin</code> , 它相当于是有主key, 和副key , 这种如果动态生成表格没法显示</p> <p>最后是把<code>parameters_origin</code> 变成 一维的数据然后进行显示</p> <p>所以当前product的schema是</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> productSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;product_id&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span>String<span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;cate_id&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  <span class="token string">&quot;product_model&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>              <span class="token comment">// 产品型号名称</span>
  <span class="token string">&quot;product_desc&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>               <span class="token comment">// 产品的简述, 提供分类页面显示的</span>
  <span class="token string">&quot;product_img&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>                <span class="token comment">// 产品主缩略图, 提供分类页面显示</span>
  <span class="token string">&quot;product_price&quot;</span><span class="token punctuation">:</span> Number<span class="token punctuation">,</span>              <span class="token comment">// 产品价格</span>
  <span class="token string">&quot;images&quot;</span><span class="token punctuation">:</span> Array<span class="token punctuation">,</span>                      <span class="token comment">// 产品图片, 产品详情页顶部显示第一张图, 点击后查看图片列表</span>
  <span class="token string">&quot;features&quot;</span><span class="token punctuation">:</span> Array<span class="token punctuation">,</span>                    <span class="token comment">// 产品特色, 详情页显示</span>
  <span class="token string">&quot;distance_img&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>               <span class="token comment">// 官方站点的产品页中的投影距离, 一般是图片但不是每个产品都有</span>
  <span class="token string">&quot;parameters&quot;</span> <span class="token punctuation">:</span> Object<span class="token punctuation">,</span>                <span class="token comment">// 官方站点的产品页中的规格, 但不是每个产品的规格的数据表格一致</span>
  <span class="token string">&quot;parameters_origin&quot;</span><span class="token punctuation">:</span> Object<span class="token punctuation">,</span>          <span class="token comment">// 官方站点的产品页中的规格, 但不是每个产品的规格的数据表格一致</span>
  <span class="token string">&quot;detail_img&quot;</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>                 <span class="token comment">// 官方站点的产品特征,有的时候是图片</span>
  <span class="token string">&quot;detail_obj&quot;</span><span class="token punctuation">:</span> Object<span class="token punctuation">,</span>                 <span class="token comment">// 官方站点的产品特征,有的时候是文字则保存为对象</span>
  <span class="token string">&quot;created&quot;</span> <span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
  <span class="token string">&quot;updated&quot;</span><span class="token punctuation">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="产品api测试地址"><a href="#产品api测试地址" aria-hidden="true" class="header-anchor">#</a> 产品API测试地址</h2> <p>我们用第一个产品来做测试</p> <p><code>http://localhost:3333/test/test-update</code>
详细的见代码</p> <p>api读取
<code>http://localhost:3333/api/product/1</code></p> <h2 id="成功案例页面数据"><a href="#成功案例页面数据" aria-hidden="true" class="header-anchor">#</a> 成功案例页面数据</h2> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        region_address<span class="token punctuation">:</span><span class="token string">&quot;城市名称上海&quot;</span>
        region_img<span class="token punctuation">:</span> <span class="token string">&quot;城市图片&quot;</span>
        region_cases<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                case_title<span class="token punctuation">:</span> <span class="token string">&quot;上海 世博园 3D Mapping Show&quot;</span>
                case_imgs<span class="token punctuation">:</span>
                    <span class="token punctuation">[</span><span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;3D Mapping Show舞台区&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;3台DU8090Z在舞台正前方投射&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;AE86随3D影像和音乐的变化穿梭于不同空间场景中&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
                case_desc<span class="token punctuation">:</span> <span class="token string">&quot;赛车3D Mapping Show于2017年1月4日在上海市黄浦区龙华东路世博园激情上演，舞台区为一个大型立方体，立方体内部的五个空间为影像投影区&quot;</span> 
                case_detail<span class="token punctuation">:</span> <span class="token string">&quot;大段的文字详情...&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                case_title<span class="token punctuation">:</span> <span class="token string">&quot;上海 世博园 3D Mapping Show&quot;</span>
                case_imgs<span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;3台DU8090Z在舞台正前方投射&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
                case_desc<span class="token punctuation">:</span> <span class="token string">&quot;赛车3D Mapping Show于2017年1月4日在上海市黄浦区龙华东路世博园激情上演，舞台区为一个大型立方体，立方体内部的五个空间为影像投影区&quot;</span> 
                case_detail<span class="token punctuation">:</span> <span class="token string">&quot;大段的文字详情...&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token operator">...</span><span class="token punctuation">.</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token punctuation">{</span>
        region_address<span class="token punctuation">:</span><span class="token string">&quot;北京&quot;</span>
        region_img<span class="token punctuation">:</span> <span class="token string">&quot;城市图片&quot;</span>
        region_cases<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                case_title<span class="token punctuation">:</span> <span class="token string">&quot;上海 世博园 3D Mapping Show&quot;</span>
                case_imgs<span class="token punctuation">:</span>
                    <span class="token punctuation">[</span><span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;3D Mapping Show舞台区&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;3台DU8090Z在舞台正前方投射&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;AE86随3D影像和音乐的变化穿梭于不同空间场景中&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
                case_desc<span class="token punctuation">:</span> <span class="token string">&quot;赛车3D Mapping Show于2017年1月4日在上海市黄浦区龙华东路世博园激情上演，舞台区为一个大型立方体，立方体内部的五个空间为影像投影区&quot;</span> 
                case_detail<span class="token punctuation">:</span> <span class="token string">&quot;大段的文字详情...&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                case_title<span class="token punctuation">:</span> <span class="token string">&quot;上海 世博园 3D Mapping Show&quot;</span>
                case_imgs<span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;3台DU8090Z在舞台正前方投射&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> img_desc<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
                case_desc<span class="token punctuation">:</span> <span class="token string">&quot;赛车3D Mapping Show于2017年1月4日在上海市黄浦区龙华东路世博园激情上演，舞台区为一个大型立方体，立方体内部的五个空间为影像投影区&quot;</span> 
                case_detail<span class="token punctuation">:</span> <span class="token string">&quot;大段的文字详情...&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token operator">...</span><span class="token punctuation">.</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span>
</code></pre></div><h2 id="案例api测试地址"><a href="#案例api测试地址" aria-hidden="true" class="header-anchor">#</a> 案例API测试地址</h2> <p>案例API测试数据</p> <p><code>mooc_data/regions_cases.js</code>    // 分区结构数据插入
<code>http://localhost:3333/test//flush-insert-case-regions</code></p> <p>当有了结构数据后, 需要插入各个分区的数据
<code>mooc_data/regions_cases.js</code>   // 分区案例数据
<code>http://localhost:3333/test/flush-insert-cases</code></p> <p>分区的数据
<code>http://localhost:3333//api/case/regions</code>
分区下的案例数据, id是用的mongodb自动生成的id
<code>http://localhost:3333/api/case/region/5b026f8ac95edf222076e05f</code></p> <h2 id="售后数据api接口"><a href="#售后数据api接口" aria-hidden="true" class="header-anchor">#</a> 售后数据API接口</h2> <p>原版本的售后页面只是列出售后网点和售后费用</p> <p>但如果有必要是可以直接在线<code>申请售后</code></p> <p>后台进行售后的<code>流程处理</code>, 在客户端显示<code>售后进程</code></p> <p>这里暂时先把售后网点和费用按原来的版本做出来, 这些数据存到mongodb中</p> <p>暂时直接把数据放到静态文件, 然后mongoose读取文件写入到mongodb</p> <h2 id="售后shema数据结构"><a href="#售后shema数据结构" aria-hidden="true" class="header-anchor">#</a> 售后shema数据结构</h2> <p>售后网点数据表<code>service_network</code></p> <p>每个地区对应一条记录doc</p> <p>这里数据的schema定义的key用的都是中文</p> <p>key用中文还是英文都是可以的, 但主要的是结构上要合理,</p> <p>比如, 把整个数据存为一个对象是很语义化的, 但是那样就只有一条记录, 存储着所有的网点信息</p> <p>如果网点数据很多的话, 那么这样的一条记录是不合理的, 因为不存在搜索, 每次数据读写都要把这条比较大的数据取出来读写,</p> <p>所以不能只顾语义化但是不利于搜索, 我们的service 表存储的数据应该是多条记录的</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> service_schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token string">'地区'</span><span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token string">'服务点'</span><span class="token punctuation">:</span> Array<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>// 数据文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> service_data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'售后服务网点'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">'地区'</span><span class="token punctuation">:</span> <span class="token string">'东北地区'</span><span class="token punctuation">,</span>
      <span class="token string">'服务点'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">'售后服务点'</span><span class="token punctuation">:</span> <span class="token string">'沈阳川海'</span><span class="token punctuation">,</span>
          <span class="token string">'地址'</span><span class="token punctuation">:</span> <span class="token string">'沈阳市和平区文萃路4号诚大数码国际广场C座703室'</span><span class="token punctuation">,</span>
          <span class="token string">'电话'</span><span class="token punctuation">:</span> <span class="token string">'024-23991229'</span><span class="token punctuation">,</span>
          <span class="token string">'维修组员'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token string">'维修人员'</span><span class="token punctuation">:</span> <span class="token string">'于金华'</span><span class="token punctuation">,</span>
              <span class="token string">'维修电话'</span><span class="token punctuation">:</span> <span class="token string">'13940175615'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">'售后服务点'</span><span class="token punctuation">:</span> <span class="token string">'大连联诚'</span><span class="token punctuation">,</span>
          <span class="token string">'地址'</span><span class="token punctuation">:</span> <span class="token string">'大连市沙河口区尚品天城1号楼1单元2202室'</span><span class="token punctuation">,</span>
          <span class="token string">'电话'</span><span class="token punctuation">:</span> <span class="token string">'0411-62636158'</span><span class="token punctuation">,</span>
          <span class="token string">'邮箱'</span><span class="token punctuation">:</span> <span class="token string">'haiailing521520@163.com'</span><span class="token punctuation">,</span>
          <span class="token string">'维修组员'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token string">'维修人员'</span><span class="token punctuation">:</span> <span class="token string">'张晓东'</span><span class="token punctuation">,</span>
              <span class="token string">'维修电话'</span><span class="token punctuation">:</span> <span class="token string">'13840903786'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token operator">...</span>
</code></pre></div><p>使用中文key键名后的搜索, 比如, 根据售后服务点的名称来搜索</p> <p>实际上是搜索doc记录中的数组</p> <p>// 搜索数组</p> <p><code>http://eksliang.iteye.com/blog/2177292</code></p> <div class="language-js extra-class"><pre class="language-js"><code> db<span class="token punctuation">.</span>services<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;服务点.售后服务点&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;西安巨光视讯&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pretty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 输出</span>

<span class="token punctuation">{</span>
        <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5b0bcb324fb1f420b82349d1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;服务点&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                        <span class="token string">&quot;售后服务点&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;西安巨光视讯&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;地址&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;西安市友谊东路242号西海大厦202室&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;电话&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;029-85562917&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;维修组员&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>
                                <span class="token punctuation">{</span>
                                        <span class="token string">&quot;维修人员&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;张钧&quot;</span><span class="token punctuation">,</span>
                                        <span class="token string">&quot;维修电话&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;13891860347&quot;</span>
                                <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;邮箱&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;zhangjun2408@126.com&quot;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;地区&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;西北地区&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;__v&quot;</span> <span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="tips"><a href="#tips" aria-hidden="true" class="header-anchor">#</a> Tips</h2> <h2 id="解构操作"><a href="#解构操作" aria-hidden="true" class="header-anchor">#</a> 解构操作</h2> <p>解构还有点不熟悉</p> <p><code>https://www.jianshu.com/p/c5230c11781b</code></p> <h2 id="node-path模块"><a href="#node-path模块" aria-hidden="true" class="header-anchor">#</a> node path模块</h2> <p><code>http://www.runoob.com/nodejs/nodejs-path-module.html</code></p> <p>用的比较多的是获取当前目录以及消除 不同操作系统的 路径差异 '/' 或 ''</p> <p>如:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> data_file <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../mooc_data/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cate.js&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="批量插入"><a href="#批量插入" aria-hidden="true" class="header-anchor">#</a> 批量插入</h2> <p>直接插入json 数据,  当有大量数据, 数组结构保存的话,  将对象转换为json 后就能直接用<code>insertMany</code></p> <p>参数 <code>{ordered : true}</code> 表示按次序</p> <p>insertMany</p> <p><code>http://mongoosejs.com/docs/api.html#Schema</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'Star Wars'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'The Empire Strikes Back'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Movies<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token punctuation">{</span>ordered <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> docs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="判断js对象不为空"><a href="#判断js对象不为空" aria-hidden="true" class="header-anchor">#</a> 判断js对象不为空</h2> <p>https://blog.csdn.net/FungLeo/article/details/78113661</p> <p><code>Object.keys(obj).length</code></p> <h2 id="js-对象的遍历"><a href="#js-对象的遍历" aria-hidden="true" class="header-anchor">#</a> js 对象的遍历</h2> <p>https://www.cnblogs.com/chenyablog/p/6477866.html</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f8bee57c.js" defer></script><script src="/assets/js/55.d8ba3a31.js" defer></script>
  </body>
</html>
