<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vuex 实现购物车 | 工作笔记</title>
    <meta name="description" content="Hendry的博客">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.eecf6a6a.css" as="style"><link rel="preload" href="/assets/js/app.f8bee57c.js" as="script"><link rel="preload" href="/assets/js/60.a209bb60.js" as="script"><link rel="prefetch" href="/assets/js/10.837bbfd0.js"><link rel="prefetch" href="/assets/js/11.bbd08110.js"><link rel="prefetch" href="/assets/js/12.eb514b46.js"><link rel="prefetch" href="/assets/js/13.e2503408.js"><link rel="prefetch" href="/assets/js/14.d97c0ac2.js"><link rel="prefetch" href="/assets/js/15.baf7986f.js"><link rel="prefetch" href="/assets/js/16.2b12bf6f.js"><link rel="prefetch" href="/assets/js/17.f7e545ac.js"><link rel="prefetch" href="/assets/js/18.70d9230d.js"><link rel="prefetch" href="/assets/js/19.0a61e7ba.js"><link rel="prefetch" href="/assets/js/2.d139c70a.js"><link rel="prefetch" href="/assets/js/20.87141f48.js"><link rel="prefetch" href="/assets/js/21.536e6d3b.js"><link rel="prefetch" href="/assets/js/22.fa3e648a.js"><link rel="prefetch" href="/assets/js/23.f6c367b9.js"><link rel="prefetch" href="/assets/js/24.a8f770f5.js"><link rel="prefetch" href="/assets/js/25.3bb8bbfc.js"><link rel="prefetch" href="/assets/js/26.1c16cfb8.js"><link rel="prefetch" href="/assets/js/27.075df559.js"><link rel="prefetch" href="/assets/js/28.90c1e366.js"><link rel="prefetch" href="/assets/js/29.3145e78e.js"><link rel="prefetch" href="/assets/js/3.de89ea98.js"><link rel="prefetch" href="/assets/js/30.9832e5bd.js"><link rel="prefetch" href="/assets/js/31.2f9a7c5b.js"><link rel="prefetch" href="/assets/js/32.df9181b5.js"><link rel="prefetch" href="/assets/js/33.ec53f96d.js"><link rel="prefetch" href="/assets/js/34.398a7128.js"><link rel="prefetch" href="/assets/js/35.bb1c5a48.js"><link rel="prefetch" href="/assets/js/36.935a5449.js"><link rel="prefetch" href="/assets/js/37.459fef35.js"><link rel="prefetch" href="/assets/js/38.f51023c1.js"><link rel="prefetch" href="/assets/js/39.ed9f7023.js"><link rel="prefetch" href="/assets/js/4.a889cc83.js"><link rel="prefetch" href="/assets/js/40.7959ecc5.js"><link rel="prefetch" href="/assets/js/41.2f350c5b.js"><link rel="prefetch" href="/assets/js/42.3a09f5a5.js"><link rel="prefetch" href="/assets/js/43.b22e3395.js"><link rel="prefetch" href="/assets/js/44.ea91f873.js"><link rel="prefetch" href="/assets/js/45.29363c9f.js"><link rel="prefetch" href="/assets/js/46.45848afe.js"><link rel="prefetch" href="/assets/js/47.309f8db5.js"><link rel="prefetch" href="/assets/js/48.4da217ee.js"><link rel="prefetch" href="/assets/js/49.713e67fd.js"><link rel="prefetch" href="/assets/js/5.7183a5fb.js"><link rel="prefetch" href="/assets/js/50.d90574c6.js"><link rel="prefetch" href="/assets/js/51.5190cc6c.js"><link rel="prefetch" href="/assets/js/52.25c37497.js"><link rel="prefetch" href="/assets/js/53.3fea90a3.js"><link rel="prefetch" href="/assets/js/54.d23ad054.js"><link rel="prefetch" href="/assets/js/55.d8ba3a31.js"><link rel="prefetch" href="/assets/js/56.bc578093.js"><link rel="prefetch" href="/assets/js/57.cb8c611e.js"><link rel="prefetch" href="/assets/js/58.4a6efece.js"><link rel="prefetch" href="/assets/js/59.397f12f2.js"><link rel="prefetch" href="/assets/js/6.6621a9ba.js"><link rel="prefetch" href="/assets/js/61.0a1b1f3b.js"><link rel="prefetch" href="/assets/js/62.a79409e9.js"><link rel="prefetch" href="/assets/js/63.f99fda12.js"><link rel="prefetch" href="/assets/js/64.59a96a9c.js"><link rel="prefetch" href="/assets/js/65.ab4be186.js"><link rel="prefetch" href="/assets/js/66.df4455cd.js"><link rel="prefetch" href="/assets/js/7.a024304b.js"><link rel="prefetch" href="/assets/js/8.be16c405.js"><link rel="prefetch" href="/assets/js/9.37e77487.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eecf6a6a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">工作笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/menu.html" class="nav-link">首页</a></div><div class="nav-item"><a href="/Android/" class="nav-link">Android</a></div><div class="nav-item"><a href="/直播/" class="nav-link">直播</a></div><div class="nav-item"><a href="/前端/" class="nav-link">前端</a></div><div class="nav-item"><a href="/公众号/" class="nav-link">公众号</a></div><div class="nav-item"><a href="/项目/" class="nav-link">项目</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">冒泡</a></li><li class="dropdown-subitem"><a href="/language/japanese.html" class="nav-link">快速</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">工厂</a></li><li class="dropdown-subitem"><a href="/language/chinese.html" class="nav-link">单例</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>vuex 实现购物车</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#api-访问接口的统一" class="sidebar-link">api 访问接口的统一</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#mutations-type-将mutations-名称统一起来" class="sidebar-link">mutations type 将mutations 名称统一起来</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#购物车" class="sidebar-link">购物车</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#完善购物车" class="sidebar-link">完善购物车</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#使用storage-来保存cart" class="sidebar-link">使用storage 来保存cart</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#购物车优化" class="sidebar-link">购物车优化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#数据安全" class="sidebar-link">数据安全</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#tips" class="sidebar-link">tips</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#路由跳转" class="sidebar-link">路由跳转</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#lodash-的使用" class="sidebar-link">lodash 的使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#vuex-中使用-subscribe-还有插件" class="sidebar-link">vuex 中使用 subscribe 还有插件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#indexof-判断数据是否存在数组" class="sidebar-link">indexof 判断数据是否存在数组</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#filter-删除元素" class="sidebar-link">filter 删除元素</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E9%A1%B9%E7%9B%AE/vue_pharmacy_fontend%E7%AC%94%E8%AE%B0/04_%E8%B4%AD%E7%89%A9%E8%BD%A6.html#使用find" class="sidebar-link">使用find</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vuex-实现购物车"><a href="#vuex-实现购物车" aria-hidden="true" class="header-anchor">#</a> vuex 实现购物车</h1> <p>首先对原有的代码进行一些结构优化</p> <h2 id="api-访问接口的统一"><a href="#api-访问接口的统一" aria-hidden="true" class="header-anchor">#</a> api 访问接口的统一</h2> <p><code>api_urls.js</code> 中定义常量</p> <p>接口的实现代码中使用这些常量 <code>src/api/product.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> api_urls <span class="token keyword">from</span> <span class="token string">&quot;./api_urls&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">api_getCats</span><span class="token punctuation">(</span> <span class="token parameter">api_url <span class="token operator">=</span> api_urls<span class="token punctuation">.</span><span class="token constant">CAT_API_URL</span> <span class="token punctuation">,</span> param <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>在store中有时可能也会用到这些常量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> api_urls <span class="token keyword">from</span> <span class="token string">&quot;@/api/api_urls&quot;</span><span class="token punctuation">;</span>

<span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span>


    <span class="token comment">// 根据传递的产品键名 获取价格信息</span>
    <span class="token function-variable function">getPackagesAction</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// let packages_api_url = &quot;http://pharmacy-backend.lindoit.com:8082/test-data/api-price&quot;;</span>
      <span class="token keyword">let</span> packages_api_url <span class="token operator">=</span> api_urls<span class="token punctuation">.</span><span class="token constant">PACKAGES_API_URL</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> name<span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">api_getPackages</span><span class="token punctuation">(</span>packages_api_url<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">SET_PACKAGES</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="mutations-type-将mutations-名称统一起来"><a href="#mutations-type-将mutations-名称统一起来" aria-hidden="true" class="header-anchor">#</a> mutations type 将mutations 名称统一起来</h2> <p>将现在mutations中的方法 都用type 名称进行统一</p> <p><code>src/store/mutations-types.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SET_CATES</span> <span class="token operator">=</span> <span class="token string">&quot;SET_CATES&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SET_PRODUCT</span> <span class="token operator">=</span> <span class="token string">&quot;SET_PRODUCT&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SET_PACKAGES</span> <span class="token operator">=</span> <span class="token string">&quot;SET_PACKAGES&quot;</span>
</code></pre></div><p>使用</p> <p><code>src/store/store.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> types <span class="token keyword">from</span> <span class="token string">&quot;@/store/mutations-types&quot;</span><span class="token punctuation">;</span>

<span class="token operator">...</span><span class="token operator">...</span>

  mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 该方法只会在分类数据成功获取才会被调用</span>
    <span class="token punctuation">[</span>types<span class="token punctuation">.</span><span class="token constant">SET_CATES</span><span class="token punctuation">]</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> cats_data<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>types<span class="token punctuation">.</span><span class="token constant">SET_PRODUCT</span><span class="token punctuation">]</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> product_data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token punctuation">}</span>

</code></pre></div><h2 id="购物车"><a href="#购物车" aria-hidden="true" class="header-anchor">#</a> 购物车</h2> <ol><li><p>在商品价格组件中, 添加购买按钮  ,点击则 添加到购物车  <code>price-packages.vue</code></p></li> <li><p>新增, 购物车组件   <code>src/components/cart/cart.vue</code></p></li> <li><p>购物车显示页面, 该页面中显示购物车详情  , 省略, 直接让购物车组件显示在<code>router-view</code> 里面</p></li> <li><p>store.js  所有的数据都在vuex 中处理</p></li></ol> <p>购物车 中需要显示package-price信息外还需要显示一些商品的信息 ,</p> <p><code>CartItem.js</code>   CartItem  作为购物车中数据类型</p> <p>它是通过点击<code>PricePackage.js</code>  触发添加到购物车 , 因此PricePackage 中需要能拿到数据</p> <p>因此需要从父控件传递到PricePackage 组件中 ,    需要的pricePackage以外的信息都需要在父组件中传递给 <code>PricePackage</code>  才能拿到</p> <p>使用 vuex  数据来实现购物车, 并不是太复杂 ,</p> <p>store中定义数据 然后判断购物车中是否存在, 如果存在就count ++ , 不存在则添加到购物车 ,</p> <p>其中还定义了购物车中的item数据类型    这些都直接看代码吧, 提交后,  后面准备拆分成模块后, 结合localstorage</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token punctuation">[</span>types<span class="token punctuation">.</span><span class="token constant">ADD_TO_CART</span><span class="token punctuation">]</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> cart_item_package<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 添加商品到购物车</span>

      <span class="token keyword">let</span> package_item_existed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token comment">// 判断是否存在, 存在则更新该产品的数据</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> state<span class="token punctuation">.</span>cart_items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>cart_items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>product_name_index <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>product_name_index <span class="token operator">&amp;&amp;</span>
          state<span class="token punctuation">.</span>cart_items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>quantity <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>quantity <span class="token operator">&amp;&amp;</span>
          state<span class="token punctuation">.</span>cart_items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>dosage <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>dosage
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          package_item_existed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          state<span class="token punctuation">.</span>cart_items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 该产品在购物车中不存在</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>package_item_existed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cart_item_package<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        state<span class="token punctuation">.</span>cart_items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cart_item_package<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 更新购物车统计数据</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">STAT_CART</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="完善购物车"><a href="#完善购物车" aria-hidden="true" class="header-anchor">#</a> 完善购物车</h2> <p>在使用storage之前,   vuex 还有进阶部分需要处理,</p> <ol><li><p>模块化</p> <p>这个还不算太复杂, 基本上就是把原本的单个的sotre文件, 拆分到模块目录下</p> <p>然后再定义 store/index.js  在这个文件中使用modules 属性进行整合</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    product<span class="token punctuation">,</span>
    cart
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  strict<span class="token punctuation">:</span> debug<span class="token punctuation">,</span>
  plugins
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></li> <li><p>使用vuex的plugin   ,  vuex中定义和使用 中间件</p></li></ol> <p>文档 <code>https://vuex.vuejs.org/zh-cn/plugins.html</code></p> <p><code>https://vuex.vuejs.org/zh-cn/plugins.html</code></p> <p>Vuex 插件就是一个函数，它接收 store 作为唯一参数</p> <p>然后, 我们在这个store上注册监听   store.subscribe  ,</p> <p>subscribe 方法可以让我们提供回调,   回调方法的参数就是, mutation , state , 这些vuex会传递给我们的回调方法</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">var</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;mutation called &quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>mutation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    product<span class="token punctuation">,</span>
    cart
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>从输出结果可见, 每次的mutation操作都会被输出,   包括<code>type</code> , <code>payload</code>  , 这正是我们关心的内容 , 有了这些我们就可以进行购物车的localstorage操作了</p> <h2 id="使用storage-来保存cart"><a href="#使用storage-来保存cart" aria-hidden="true" class="header-anchor">#</a> 使用storage 来保存cart</h2> <p>参考demo <code>https://github.com/teepluss/vue-shoppping-cart</code></p> <p>步骤一 : localstorage 存储 购物车json字符串</p> <p>这个代码片段也可以看看  <code>https://gist.github.com/lorbicki/0409658c1d18a60281a5cb2309bf421b</code></p> <p>基本原理是把购物车转换成<code>json</code>字符串, 然后<code>localStorage.setItem</code> 保存起来</p> <div class="language-s extra-class"><pre class="language-text"><code>localStorage.setItem('shopping_cart', JSON.stringify(final_cart));
</code></pre></div><p>当需要的时候, 再把字符串取出来,   取出来后还是json字符串,  转换成<code>对象</code>即可</p> <div class="language-js extra-class"><pre class="language-js"><code>cart_json <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'shopping_cart'</span><span class="token punctuation">)</span>
cart <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cart_json<span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>cart <span class="token operator">=</span> storedCart <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>storedCart<span class="token punctuation">)</span> <span class="token punctuation">:</span> _<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> defaultCart<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>步骤二:  当购物车数据发生变化, 必须要更新localstorage中的存储</p> <p><code>https://gist.github.com/malles/2feff9ff88597eca34b6601f64656db4</code></p> <p>这个代码片段虽然比较老 ,  当中的vue-resource已经弃用, 但watch 部分, 正是实现更新localstorage的</p> <div class="language-js extra-class"><pre class="language-js"><code>
    watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'cart'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token function-variable function">handler</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cart</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'bixcart.cart'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> deep<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'total_price'</span><span class="token punctuation">:</span> <span class="token string">'saveCart'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>步骤三:  结合vuex</p> <p>上面使用watch来对localstorage进行更新, 那是在组件中 , 可是我们的组件基本上是不处理数据的, 数据都是store来处理, 所以组件中watch 购物车数据和我们的原则是违背的</p> <p>我们应该同样的在store中来<code>检测</code>购物车的数据变化, 方法就是  <code>store.subscribe</code></p> <p><code>https://github.com/teepluss/vue-shoppping-cart/blob/master/src/store/index.js</code></p> <p>而且这个例子中还把 , vuex 中的数据, 进行了模块化 ;</p> <p>然后把 以中间件形式 调用 store.subscribe .</p> <p>当上面知识点都完善, 改造vuex结合localstorage太简单了 ,只需要两步</p> <ol><li><p>注册vuex 插件, 只要是针对购物车的mutation , 那么就把购物车的数据 JSON.stringify  返回的json 进行保存 window.localStorage.setItem</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">saveCartPlug</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span><span class="token punctuation">{</span>cart<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是购物车相关的 mutation 那么就保存到浏览器</span>
    <span class="token comment">// console.log(&quot;mutation called : &quot; + JSON.stringify(mutation));</span>

    <span class="token keyword">let</span> cart_mutations <span class="token operator">=</span> <span class="token punctuation">[</span>types<span class="token punctuation">.</span><span class="token constant">ADD_TO_CART</span><span class="token punctuation">,</span>types<span class="token punctuation">.</span><span class="token constant">CLEAR_CART</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>cart_mutations<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 保存数据</span>
      <span class="token comment">// console.log(&quot;cart mutation :&quot; + JSON.stringify(mutation));</span>
      <span class="token comment">// console.log(&quot;cart state  :&quot; + JSON.stringify(cart));</span>
      window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">CART_NAME</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span>cart_items<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>在cart 的state 初始化的时候 , 从localStorage中读取数据即可 , 将返回的json调用   JSON.parse 将json转为对象</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">:</span><span class="token punctuation">{</span>    <span class="token comment">//购物车相关的数据</span>
    cart_items<span class="token punctuation">:</span>  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span> types<span class="token punctuation">.</span><span class="token constant">CART_NAME</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>经过上面的两部后 , 购物车的数据就已经可以正常存储了</p> <h2 id="购物车优化"><a href="#购物车优化" aria-hidden="true" class="header-anchor">#</a> 购物车优化</h2> <ol><li><p>更新统计信息</p> <p>原本的统计信息是用mutation  , <code>STAT_CART</code> , 且数据存储本地后, 这个统计不能及时更新,  想办法解决时发现 <code>STAT_CART</code> 实际上没有必要,   可以直接在getters中进行统计</p> <p>// 整个的cart_getter 被映射为cart ,  在组件中直接使用cart 即可 , 而且统计数据是更新好了的</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">cart_getter</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        cart_items<span class="token punctuation">:</span> state<span class="token punctuation">.</span>cart_items<span class="token punctuation">,</span>
        cart_total_count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>cart_items<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span>item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> sum <span class="token operator">+</span> item<span class="token punctuation">.</span>count
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        cart_total_price<span class="token punctuation">:</span> state<span class="token punctuation">.</span>cart_items<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span>item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> total <span class="token operator">+</span> item<span class="token punctuation">.</span>count <span class="token operator">*</span> item<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>使用action 来调用 mutation</p></li></ol> <p>我们在组件中依然有使用 this.$store.commit  这样对组件是入侵式的,   那么我们可以把这种同步的操作也方法action中 , 因为action是可以map的</p> <p>而mutations 是没有map的,   所以 这样可以, 让我们在组件中的代码  都是调用map后的方法名,  去调用action , action 调用mutation , 这样就入侵更少了</p> <p><code>src/store/cart/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">action_clear_cart</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>commit<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">commit</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">CLEAR_CART</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">action_add_to_cart</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>commit<span class="token punctuation">}</span><span class="token punctuation">,</span>cart_item_package</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">commit</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">ADD_TO_CART</span> <span class="token punctuation">,</span> cart_item_package<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>// cart.vue</p> <div class="language-js extra-class"><pre class="language-js"><code>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        clear_cart<span class="token punctuation">:</span> <span class="token string">&quot;action_clear_cart&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">//      clear_cart() {</span>
<span class="token comment">//        this.$store.commit(types.CLEAR_CART);</span>
<span class="token comment">//      }</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>完善购物车的添加删除</p> <p>// TODO</p> <h2 id="数据安全"><a href="#数据安全" aria-hidden="true" class="header-anchor">#</a> 数据安全</h2> <ol><li><p>localstorage 的数据, 还有从服务器端下载的package_price信息都是明文的</p> <p>我们可以把数据进行加密 , 这样起码不至于让别人可以很直观的修改数据</p></li> <li><p>服务器端的验证,  原则是客户端提交的任何数据都作为不可信数据</p> <p>比如购物车数据中的价格 ,  我们在服务器端都是需要全部重新计算才行</p></li> <li><p>后续待完善的  , 还有用户体验</p> <p>就是说购物车的显示, 应该分为两块 , 一个是组件式当前页面显示缩略信息   ,   一个是完整页面显示所有的购物车项</p></li></ol> <h2 id="tips"><a href="#tips" aria-hidden="true" class="header-anchor">#</a> tips</h2> <p>组件中使用图片</p> <ol><li><p>图片拷贝到目录 比如<code>src/assets/img/button_in_cart.gif</code></p></li> <li><p>使用import引入并定义图片变量</p> <p><code>import cart_img from '@/assets/img/button_in_cart.gif'</code></p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        cart_img<span class="token punctuation">:</span>cart_img
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>使用该图片</p></li></ol> <p><code>&lt;img :src=cart_img alt=&quot;add_to_cart&quot;&gt;</code></p> <h2 id="路由跳转"><a href="#路由跳转" aria-hidden="true" class="header-anchor">#</a> 路由跳转</h2> <p>实际情况下，有很多按钮在执行跳转之前，还会执行一系列方法，这时可以使用 this.$router.push(location) 来修改 url，完成跳转</p> <p>push 参数可以是对象，也可以是字符串：</p> <p>// 字符串</p> <p><code>this.$router.push('/home/first')</code></p> <p>// 对象</p> <p><code>this.$router.push({ path: '/home/first' })</code></p> <p>// 命名的路由</p> <p><code>this.$router.push({ name: 'home', params: { userId: wise }})</code></p> <h2 id="lodash-的使用"><a href="#lodash-的使用" aria-hidden="true" class="header-anchor">#</a> lodash 的使用</h2> <p><code>https://www.youtube.com/watch?v=hI_8DSDN9CY</code></p> <p>基本上这里也没有用到lodash   ,   用原生的也可以做到类似只是有点不效率</p> <p>另外就是 es6 ..  对于老的浏览器有兼容问题, 但如果是结合转 es5的话 , 就没有什么问题了</p> <h2 id="vuex-中使用-subscribe-还有插件"><a href="#vuex-中使用-subscribe-还有插件" aria-hidden="true" class="header-anchor">#</a> vuex 中使用 subscribe 还有插件</h2> <p><code>https://vuex.vuejs.org/zh-cn/plugins.html</code></p> <p>Vuex 插件就是一个函数，它接收 store 作为唯一参数</p> <p>然后, 我们在这个store上注册监听   store.subscribe  ,</p> <p>subscribe 方法可以让我们提供回调,   回调方法的参数就是, mutation , state , 这些vuex会传递给我们的回调方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;mutation called &quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>mutation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    product<span class="token punctuation">,</span>
    cart
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>从输出结果可见, 每次的mutation操作都会被输出,   包括<code>type</code> , <code>payload</code>  , 这正是我们关心的内容 , 有了这些我们就可以进行购物车的localstorage操作了</p> <h2 id="indexof-判断数据是否存在数组"><a href="#indexof-判断数据是否存在数组" aria-hidden="true" class="header-anchor">#</a> indexof 判断数据是否存在数组</h2> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">if</span><span class="token punctuation">(</span>cart_mutations<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 保存数据</span>
      <span class="token comment">// console.log(&quot;cart mutation :&quot; + JSON.stringify(mutation));</span>
      <span class="token comment">// console.log(&quot;cart state  :&quot; + JSON.stringify(cart));</span>
      window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token constant">CART_NAME</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span>cart_items<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="filter-删除元素"><a href="#filter-删除元素" aria-hidden="true" class="header-anchor">#</a> filter 删除元素</h2> <p><code>https://msdn.microsoft.com/zh-cn/library/ff679973(v=vs.94).aspx</code></p> <p><code>return false</code> 即可</p> <p>如:求质数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Define a callback function.</span>
<span class="token keyword">function</span> <span class="token function">CheckIfPrime</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> index<span class="token punctuation">,</span> ar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    high <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> div <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> div <span class="token operator">&lt;=</span> high<span class="token punctuation">;</span> div<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">%</span> div <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Create the original array.</span>
<span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Get the prime numbers that are in the original array. </span>
<span class="token keyword">var</span> primes <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>CheckIfPrime<span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>primes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output: 31,37,41,43,47,53</span>
</code></pre></div><p>但我们这里用filter一直有bug ,  filter返回的数据经常是空数组 ,  把整个购物车清空了</p> <p>最后是用的<code>forEach</code> , 确实forEach 很强大, 参数能包括index 还能包括数组本身, 正好可以用来完成功能</p> <div class="language-js extra-class"><pre class="language-js"><code>      state<span class="token punctuation">.</span>cart_items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span>index<span class="token punctuation">,</span>arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        <span class="token comment">// 找到对应的购物车项 , 减一</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> p<span class="token punctuation">.</span>product_name_index <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>product_name_index <span class="token operator">&amp;&amp;</span>
          p<span class="token punctuation">.</span>quantity <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>quantity <span class="token operator">&amp;&amp;</span>
          p<span class="token punctuation">.</span>dosage <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>dosage<span class="token punctuation">)</span><span class="token punctuation">{</span>
          p<span class="token punctuation">.</span>count<span class="token operator">--</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果数量小于1 , 删除该项</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>count<span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="使用find"><a href="#使用find" aria-hidden="true" class="header-anchor">#</a> 使用find</h2> <p>js中居然还有find这么好用的东西 , 比如</p> <div class="language-js extra-class"><pre class="language-js"><code>      <span class="token keyword">const</span> record <span class="token operator">=</span> state<span class="token punctuation">.</span>cart_items<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>product_name_index <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>product_name_index <span class="token operator">&amp;&amp;</span>
        p<span class="token punctuation">.</span>quantity <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>quantity <span class="token operator">&amp;&amp;</span>
        p<span class="token punctuation">.</span>dosage <span class="token operator">==</span> cart_item_package<span class="token punctuation">.</span>dosage
      <span class="token punctuation">)</span>

      record<span class="token punctuation">.</span>count<span class="token operator">--</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f8bee57c.js" defer></script><script src="/assets/js/60.a209bb60.js" defer></script>
  </body>
</html>
